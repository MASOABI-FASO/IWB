<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IWB - Electronic Recycling Solutions</title>
    <link rel="stylesheet" href="enhancements.css">
    <style>
        :root {
            --primary-color: #2e7d32;
            --secondary-color: #81c784;
            --accent-color: #ff8f00;
            --light-color: #f5f5f5;
            --dark-color: #333;
            --danger-color: #d32f2f;
            --info-color: #1976d2;
            --warning-color: #ffa000;
            --investor-color: #7b1fa2;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: var(--light-color);
            color: var(--dark-color);
            line-height: 1.6;
        }
        
        header {
            background-color: var(--primary-color);
            color: white;
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
        }
        
        .logo {
            display: flex;
            align-items: center;
        }
        
        .logo img {
            height: 50px;
            margin-right: 15px;
        }
        
        .logo h1 {
            font-size: 1.8rem;
        }
        
        nav ul {
            display: flex;
            list-style: none;
        }
        
        nav ul li {
            margin-left: 1.5rem;
            position: relative;
        }
        
        nav ul li a {
            color: white;
            text-decoration: none;
            font-weight: 500;
            transition: color 0.3s;
            display: flex;
            align-items: center;
        }
        
        nav ul li a:hover {
            color: var(--secondary-color);
        }
        
        .nav-badge {
            background-color: var(--accent-color);
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 0.7rem;
            margin-left: 5px;
        }
        
        .hero {
            background: linear-gradient(rgba(0,0,0,0.7), rgba(0,0,0,0.7)), url('https://images.unsplash.com/photo-1518770660439-4636190af475?ixlib=rb-1.2.1&auto=format&fit=crop&w=1350&q=80');
            background-size: cover;
            background-position: center;
            height: 60vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            color: white;
            padding: 0 2rem;
        }
        
        .hero h2 {
            font-size: 2.5rem;
            margin-bottom: 1rem;
        }
        
        .hero p {
            font-size: 1.2rem;
            max-width: 800px;
            margin-bottom: 2rem;
        }
        
        .btn {
            display: inline-block;
            background-color: var(--accent-color);
            color: white;
            padding: 0.8rem 1.5rem;
            border: none;
            border-radius: 5px;
            text-decoration: none;
            font-weight: bold;
            transition: all 0.3s;
            cursor: pointer;
        }
        
        .btn:hover {
            background-color: #ff6f00;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .btn:active {
            transform: translateY(0);
            box-shadow: none;
        }
        
        .container {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 0 2rem;
        }
        
        .section-title {
            text-align: center;
            margin-bottom: 2rem;
            color: var(--primary-color);
            font-size: 2rem;
            position: relative;
        }
        
        .section-title::after {
            content: '';
            display: block;
            width: 80px;
            height: 4px;
            background-color: var(--accent-color);
            margin: 0.5rem auto 0;
            border-radius: 2px;
        }
        
        .services {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin-bottom: 3rem;
        }
        
        .service-card {
            background-color: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            transition: transform 0.3s, box-shadow 0.3s;
            position: relative;
        }
        
        .service-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.15);
        }
        
        .service-card img {
            width: 100%;
            height: 200px;
            object-fit: cover;
            transition: transform 0.3s;
        }
        
        .service-card:hover img {
            transform: scale(1.05);
        }
        
        .service-content {
            padding: 1.5rem;
        }
        
        .service-content h3 {
            margin-bottom: 1rem;
            color: var(--primary-color);
        }
        
        .products {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 2rem;
        }
        
        .product-card {
            background-color: white;
            border-radius: 8px;
            padding: 1.5rem;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s, box-shadow 0.3s;
        }
        
        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 15px rgba(0,0,0,0.1);
        }
        
        .product-card h3 {
            color: var(--primary-color);
            margin-bottom: 0.5rem;
        }
        
        .product-card .price {
            font-weight: bold;
            color: var(--accent-color);
            margin: 0.5rem 0;
            font-size: 1.2rem;
        }
        
        .product-card .btn {
            margin-top: auto;
            align-self: flex-start;
        }
        
        .dashboard {
            display: none;
            margin-top: 2rem;
        }
        
        .dashboard.active {
            display: block;
            animation: fadeIn 0.5s ease-in-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .tabs {
            display: flex;
            border-bottom: 1px solid #ddd;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }
        
        .tab {
            padding: 0.8rem 1.5rem;
            cursor: pointer;
            border: 1px solid transparent;
            border-bottom: none;
            border-radius: 5px 5px 0 0;
            margin-right: 0.5rem;
            background-color: #f1f1f1;
            transition: all 0.3s;
            font-weight: 500;
        }
        
        .tab:hover {
            background-color: #e0e0e0;
        }
        
        .tab.active {
            background-color: white;
            border-color: #ddd;
            border-bottom: 1px solid white;
            margin-bottom: -1px;
            font-weight: bold;
            color: var(--primary-color);
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        form {
            background-color: white;
            padding: 2rem;
            border-radius: 8px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            max-width: 600px;
            margin: 0 auto;
        }
        
        .form-group {
            margin-bottom: 1.5rem;
        }
        
        label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 0.8rem;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(46, 125, 50, 0.2);
        }
        
        textarea {
            min-height: 120px;
            resize: vertical;
        }
        
        .form-actions {
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
        }
        
        .btn-secondary {
            background-color: #757575;
        }
        
        .btn-secondary:hover {
            background-color: #616161;
        }
        
        .btn-danger {
            background-color: var(--danger-color);
        }
        
        .btn-danger:hover {
            background-color: #b71c1c;
        }
        
        .btn-info {
            background-color: var(--info-color);
        }
        
        .btn-info:hover {
            background-color: #1565c0;
        }
        
        .btn-warning {
            background-color: var(--warning-color);
        }
        
        .btn-warning:hover {
            background-color: #ff8f00;
        }
        
        .btn-investor {
            background-color: var(--investor-color);
        }
        
        .btn-investor:hover {
            background-color: #6a1b9a;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 2rem;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        th, td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        
        th {
            background-color: var(--primary-color);
            color: white;
            font-weight: 500;
            position: sticky;
            top: 60px;
        }
        
        tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        
        tr:hover {
            background-color: #f1f1f1;
        }
        
        .action-btns {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }
        
        .action-btn {
            padding: 0.3rem 0.6rem;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.2s;
        }
        
        .action-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .edit-btn {
            background-color: #1976d2;
            color: white;
        }
        
        .delete-btn {
            background-color: var(--danger-color);
            color: white;
        }
        
        .view-btn {
            background-color: var(--primary-color);
            color: white;
        }
        
        .export-btn {
            background-color: #5c6bc0;
            color: white;
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .stat-card {
            background-color: white;
            padding: 1.5rem;
            border-radius: 8px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            text-align: center;
            transition: transform 0.3s;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
        }
        
        .stat-card h3 {
            color: var(--primary-color);
            margin-bottom: 0.5rem;
            font-size: 1rem;
        }
        
        .stat-card .value {
            font-size: 2rem;
            font-weight: bold;
            color: var(--accent-color);
        }
        
        .stat-card .subtext {
            font-size: 0.8rem;
            color: #666;
            margin-top: 0.3rem;
        }
        
        footer {
            background-color: var(--dark-color);
            color: white;
            padding: 2rem;
            text-align: center;
            margin-top: 3rem;
        }
        
        .footer-content {
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
            max-width: 1200px;
            margin: 0 auto 2rem;
        }
        
        .footer-section {
            flex: 1;
            min-width: 250px;
            margin-bottom: 1.5rem;
        }
        
        .footer-section h3 {
            margin-bottom: 1rem;
            color: var(--secondary-color);
        }
        
        .social-icons {
            display: flex;
            justify-content: center;
            gap: 1rem;
        }
        
        .social-icons a {
            color: white;
            font-size: 1.5rem;
            transition: color 0.3s;
        }
        
        .social-icons a:hover {
            color: var(--secondary-color);
        }
        
        .copyright {
            border-top: 1px solid #444;
            padding-top: 1rem;
            font-size: 0.9rem;
        }

        /* Login and user management styles */
        .login-container {
            max-width: 500px;
            margin: 5rem auto;
            padding: 2rem;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            transition: transform 0.3s, box-shadow 0.3s;
        }
        
        .login-container:hover {
            box-shadow: 0 15px 35px rgba(0,0,0,0.15);
        }

        .login-container h2 {
            text-align: center;
            margin-bottom: 1.5rem;
            color: var(--primary-color);
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-left: auto;
        }

        .user-info img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid white;
        }

        .logout-btn {
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            font-weight: 500;
            transition: color 0.3s;
        }
        
        .logout-btn:hover {
            color: var(--secondary-color);
        }

        .status-badge {
            padding: 0.3rem 0.6rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
            display: inline-block;
        }

        .status-pending {
            background-color: #fff3e0;
            color: #e65100;
        }

        .status-completed {
            background-color: #e8f5e9;
            color: #2e7d32;
        }
        
        .status-active {
            background-color: #e3f2fd;
            color: #1565c0;
        }
        
        .status-inactive {
            background-color: #f5f5f5;
            color: #616161;
        }

        .mfa-setup {
            background-color: #e3f2fd;
            padding: 1rem;
            border-radius: 5px;
            margin-top: 1rem;
        }

        .access-denied {
            text-align: center;
            padding: 2rem;
            color: var(--danger-color);
            background-color: #ffebee;
            border-radius: 8px;
            margin: 2rem 0;
        }

        .role-selector {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }

        .role-btn {
            padding: 0.8rem 1.5rem;
            border: 2px solid var(--primary-color);
            border-radius: 5px;
            background: none;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }

        .role-btn.active {
            background-color: var(--primary-color);
            color: white;
        }

        .role-btn:hover {
            background-color: var(--secondary-color);
            border-color: var(--secondary-color);
            color: white;
        }
        
        .role-btn.investor {
            border-color: var(--investor-color);
            color: var(--investor-color);
        }
        
        .role-btn.investor.active {
            background-color: var(--investor-color);
            color: white;
        }
        
        .role-btn.investor:hover {
            background-color: var(--investor-color);
            border-color: var(--investor-color);
            color: white;
        }

        .hidden {
            display: none;
        }

        .alert {
            padding: 1rem;
            border-radius: 5px;
            margin-bottom: 1rem;
            text-align: center;
            animation: slideIn 0.3s ease-out;
        }
        
        @keyframes slideIn {
            from { transform: translateY(-20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .alert-success {
            background-color: #e8f5e9;
            color: #2e7d32;
            border: 1px solid #a5d6a7;
        }

        .alert-error {
            background-color: #ffebee;
            color: #d32f2f;
            border: 1px solid #ef9a9a;
        }
        
        .alert-info {
            background-color: #e3f2fd;
            color: #1565c0;
            border: 1px solid #90caf9;
        }
        
        .alert-warning {
            background-color: #fff8e1;
            color: #ff8f00;
            border: 1px solid #ffe082;
        }

        /* Modal styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background-color: white;
            padding: 2rem;
            border-radius: 8px;
            max-width: 800px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
            animation: modalFadeIn 0.3s ease-out;
        }
        
        @keyframes modalFadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid #eee;
        }
        
        .modal-header h3 {
            color: var(--primary-color);
            margin: 0;
        }
        
        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #666;
            transition: color 0.3s;
        }
        
        .close-modal:hover {
            color: var(--danger-color);
        }
        
        /* Bulk actions */
        .bulk-actions {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
            align-items: center;
        }
        
        .select-all-checkbox {
            margin-right: 0.5rem;
        }
        
        /* System health indicators */
        .health-indicator {
            display: flex;
            align-items: center;
            margin-bottom: 0.5rem;
        }
        
        .health-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 0.5rem;
        }
        
        .health-good {
            background-color: #4caf50;
        }
        
        .health-warning {
            background-color: #ffc107;
        }
        
        .health-critical {
            background-color: #f44336;
        }
        
        /* Responsive tables */
        .table-responsive {
            overflow-x: auto;
        }
        
        /* Loading spinner */
        .spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Responsive styles */
        @media (max-width: 768px) {
            header {
                flex-direction: column;
                padding: 1rem;
            }
            
            nav ul {
                margin-top: 1rem;
                flex-wrap: wrap;
                justify-content: center;
            }
            
            nav ul li {
                margin: 0.5rem;
            }
            
            .hero h2 {
                font-size: 2rem;
            }
            
            .hero p {
                font-size: 1rem;
            }
            
            .tabs {
                flex-wrap: wrap;
            }
            
            .tab {
                margin-bottom: 0.5rem;
                flex: 1;
                text-align: center;
            }

            .user-info {
                margin-top: 1rem;
                margin-left: 0;
            }

            .role-selector {
                flex-direction: column;
                gap: 0.5rem;
            }
            
            .form-actions {
                flex-direction: column;
                gap: 0.5rem;
            }
            
            .action-btns {
                flex-direction: column;
                gap: 0.3rem;
            }
            
            .stats {
                grid-template-columns: 1fr 1fr;
            }
            
            .modal-content {
                padding: 1rem;
            }
        }
        
        @media (max-width: 480px) {
            .stats {
                grid-template-columns: 1fr;
            }
            
            .service-card, .product-card {
                width: 100%;
            }
        }
        .modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.5);
    justify-content: center;
    align-items: center;
    z-index: 1000;
}

.modal-content {
    background-color: white;
    padding: 2rem;
    border-radius: 8px;
    max-width: 600px;
    width: 90%;
    max-height: 80vh;
    overflow-y: auto;
}

.modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1rem;
}

.close-modal {
    background: none;
    border: none;
    font-size: 1.5rem;
    cursor: pointer;
}

.status-badge {
    padding: 0.3rem 0.8rem;
    border-radius: 12px;
    font-size: 0.9rem;
}

.status-pending {
    background-color: #fff3e0;
    color: #e65100;
}

.status-completed {
    background-color: #e8f5e9;
    color: #2e7d32;
}
    </style>
</head>
<body>
    <header id="main-header" class="hidden">
        <div class="logo">
            <img src="https://via.placeholder.com/50x50?text=IWB" alt="IWB Logo">
            <h1>IWB Recycling</h1>
        </div>
        <nav id="main-nav">
            <ul id="nav-links">
                <li><a href="#" class="nav-link" data-section="home">Home</a></li>
                <li><a href="#" class="nav-link" data-section="services">Services</a></li>
                <li><a href="#" class="nav-link" data-section="products">Products</a></li>
                <li id="dashboard-nav-item" class="hidden"><a href="#" class="nav-link" data-section="dashboard">Dashboard</a></li>
                <li id="queries-nav-item" class="hidden"><a href="#" class="nav-link" data-section="queries">Customer Queries <span id="queries-badge" class="nav-badge hidden"></span></a></li>
                <li id="inbox-nav-item" class="hidden"><a href="#" class="nav-link" data-section="inbox">My Inbox <span id="inbox-badge" class="nav-badge hidden"></span></a></li>
                <li id="investor-nav-item" class="hidden"><a href="#" class="nav-link" data-section="investor">Investor Portal</a></li>
                <li><a href="#" class="nav-link" data-section="contact">Contact</a></li>
            </ul>
        </nav>
        <div class="user-info" id="user-info">
            <img src="https://via.placeholder.com/40x40?text=User" alt="User" id="user-avatar">
            <span id="username-display"></span>
            <button class="logout-btn" id="logout-btn">Logout</button>
        </div>
    </header>

    <!-- Login Section -->
    <section id="login" class="section">
        <div class="login-container">
            <h2>IWB Portal Login</h2>
            
            <div id="login-alert" class="alert hidden"></div>
            
            <div class="role-selector">
                <button class="role-btn" data-role="customer">Customer</button>
                <button class="role-btn" data-role="employee">IWB Employee</button>
                <button class="role-btn investor" data-role="investor">Investor</button>
            </div>

            <div id="employee-role-selector" class="hidden" style="margin-top: 1rem;">
                <select id="employee-role" class="form-control" required>
                    <option value="">Select Employee Role</option>
                    <option value="admin">Administrator</option>
                    <option value="sales">Sales Personnel</option>
                    <option value="finance">Finance Personnel</option>
                    <option value="developer">Developer</option>
                    <option value="partner">Partner (IWC)</option>
                </select>
            </div>
            
            <form id="login-form">
                <div class="form-group">
                    <label for="login-email">Email</label>
                    <input type="email" id="login-email" required>
                </div>
                <div class="form-group">
                    <label for="login-password">Password</label>
                    <input type="password" id="login-password" required>
                </div>
                <div class="form-group mfa-setup hidden" id="mfa-section">
                    <label for="login-mfa">MFA Code (6 digits)</label>
                    <input type="text" id="login-mfa" pattern="\d{6}" placeholder="123456">
                    <p style="font-size: 0.8rem; margin-top: 0.5rem;">Use your authenticator app to get the code</p>
                </div>
                <div class="form-actions">
                    <button type="submit" class="btn">Login</button>
                </div>
            </form>
            
            <div class="register-link" id="register-link">
                <p>Don't have an account? <a href="#" id="show-register">Register as Customer</a></p>
            </div>
        </div>
    </section>

    <!-- Registration Section -->
    <section id="register" class="section hidden">
        <div class="login-container">
            <h2>Customer Registration</h2>
            
            <div id="register-alert" class="alert hidden"></div>
            
            <form id="register-form">
                <div class="form-group">
                    <label for="register-name">Full Name</label>
                    <input type="text" id="register-name" required>
                </div>
                <div class="form-group">
                    <label for="register-email">Email</label>
                    <input type="email" id="register-email" required>
                </div>
                <div class="form-group">
                    <label for="register-password">Password</label>
                    <input type="password" id="register-password" required minlength="8">
                    <p style="font-size: 0.8rem; margin-top: 0.3rem; color: #666;">Minimum 8 characters</p>
                </div>
                <div class="form-group">
                    <label for="register-confirm">Confirm Password</label>
                    <input type="password" id="register-confirm" required>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" id="cancel-register">Cancel</button>
                    <button type="submit" class="btn">Register</button>
                </div>
            </form>
        </div>
    </section>

    <section id="home" class="section hidden">
        <div class="hero">
            <h2>Electronic Recycling Solutions for Southern Africa</h2>
            <p>IWB is pioneering sustainable electronic waste management in Lesotho and beyond, specializing in RAM, hard drives, and motherboard components recycling.</p>
            <a href="#" class="btn nav-link" data-section="services">Our Services</a>
        </div>
    </section>

    <section id="services" class="section hidden">
        <div class="container">
            <h2 class="section-title">Our Recycling Services</h2>
            <div class="services">
                <div class="service-card">
                    <img src="https://images.unsplash.com/photo-1597852074816-d933c7d2b988?ixlib=rb-1.2.1&auto=format&fit=crop&w=1350&q=80" alt="RAM Recycling">
                    <div class="service-content">
                        <h3>RAM Recycling</h3>
                        <p>We specialize in the safe and efficient recycling of all types of RAM modules, recovering valuable materials while ensuring data security.</p>
                    </div>
                </div>
                <div class="service-card">
                    <img src="https://images.unsplash.com/photo-1621786032397-9fa1e8b5cfe2?ixlib=rb-1.2.1&auto=format&fit=crop&w=1350&q=80" alt="Hard Drive Recycling">
                    <div class="service-content">
                        <h3>Hard Drive Recycling</h3>
                        <p>Secure data destruction and material recovery for all types of hard drives, including HDDs and SSDs, with certified data wiping.</p>
                    </div>
                </div>
                <div class="service-card">
                    <img src="https://images.unsplash.com/photo-1611186871348-b1ce696e52c9?ixlib=rb-1.2.1&auto=format&fit=crop&w=1350&q=80" alt="Motherboard Components">
                    <div class="service-content">
                        <h3>Motherboard Components</h3>
                        <p>Advanced recycling solutions for motherboard components, extracting precious metals and properly disposing of hazardous materials.</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section id="products" class="section hidden">
        <div class="container">
            <h2 class="section-title">Refurbished Products</h2>
            <div class="products" id="products-container">
                <!-- Products will be loaded here dynamically -->
            </div>
        </div>
    </section>

    <section id="dashboard" class="section hidden">
        <div class="container">
            <h2 class="section-title">Management Dashboard</h2>
            
            <div id="finance-access-denied" class="access-denied hidden">
                <h3>Access Denied</h3>
                <p>You don't have permission to access the financial dashboard.</p>
            </div>
            
            <div id="sales-access-denied" class="access-denied hidden">
                <h3>Access Denied</h3>
                <p>You don't have permission to access the sales dashboard.</p>
            </div>
            
            <div id="developer-access-denied" class="access-denied hidden">
                <h3>Access Denied</h3>
                <p>You don't have permission to access developer tools.</p>
            </div>
            
            <div class="tabs">
                <div class="tab active" data-tab="inventory">Inventory</div>
                <div class="tab" data-tab="sales">Sales</div>
                <div class="tab" data-tab="finance">Income Statement</div>
                <div class="tab" data-tab="add">Add Product</div>
                <div class="tab" data-tab="reports">Reports</div>
                <div class="tab" data-tab="users">User Management</div>
                <div class="tab" data-tab="settings">Settings</div>
            </div>
            
            <div class="dashboard active" id="inventory-tab">
                <div class="stats">
                    <div class="stat-card">
                        <h3>Total Products</h3>
                        <div class="value" id="total-products">0</div>
                        <div class="subtext">Across all categories</div>
                    </div>
                    <div class="stat-card">
                        <h3>Items Sold</h3>
                        <div class="value" id="items-sold">0</div>
                        <div class="subtext">This month</div>
                    </div>
                    <div class="stat-card">
                        <h3>Inventory Value</h3>
                        <div class="value" id="inventory-value">M 0</div>
                        <div class="subtext">Current stock value</div>
                    </div>
                    <div class="stat-card">
                        <h3>Low Stock Items</h3>
                        <div class="value" id="low-stock-items">0</div>
                        <div class="subtext">Needs restocking</div>
                    </div>
                </div>
                
                <div class="table-responsive">
                    <table id="inventory-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Product Name</th>
                                <th>Category</th>
                                <th>Quantity</th>
                                <th>Price</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="inventory-body">
                            <!-- Inventory items will be added here dynamically -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <div class="dashboard" id="sales-tab">
                <div class="stats">
                    <div class="stat-card">
                        <h3>Monthly Sales</h3>
                        <div class="value" id="monthly-sales">M 0</div>
                        <div class="subtext">Current month</div>
                    </div>
                    <div class="stat-card">
                        <h3>Transactions</h3>
                        <div class="value" id="total-transactions">0</div>
                        <div class="subtext">Completed sales</div>
                    </div>
                    <div class="stat-card">
                        <h3>Avg. Order Value</h3>
                        <div class="value" id="avg-order-value">M 0</div>
                        <div class="subtext">Per transaction</div>
                    </div>
                    <div class="stat-card">
                        <h3>Top Product</h3>
                        <div class="value" id="top-product">-</div>
                        <div class="subtext">By units sold</div>
                    </div>
                </div>
                
                <div class="bulk-actions">
                    <input type="checkbox" id="select-all-sales" class="select-all-checkbox">
                    <label for="select-all-sales">Select All</label>
                    <button class="btn btn-danger" id="delete-selected-sales">Delete Selected</button>
                    <button class="btn btn-secondary" id="export-sales">Export to CSV</button>
                </div>
                
                <div class="table-responsive">
                    <table id="sales-table">
                        <thead>
                            <tr>
                                <th></th>
                                <th>Sale ID</th>
                                <th>Date</th>
                                <th>Customer</th>
                                <th>Product</th>
                                <th>Quantity</th>
                                <th>Total</th>
                                <th>Status</th>
                                <th>Sales Person</th>
                            </tr>
                        </thead>
                        <tbody id="sales-body">
                            <!-- Sales records will be added here dynamically -->
                        </tbody>
                    </table>
                </div>
                
                <div style="display: flex; gap: 1rem; margin-top: 1rem;">
                    <button class="btn" id="add-sale-btn">Add New Sale</button>
                    <button class="btn btn-info" id="refresh-sales">Refresh Data</button>
                </div>
                
                <div id="sale-form-container" style="display: none; margin-top: 2rem;">
                    <form id="sale-form">
                        <div class="form-group">
                            <label for="sale-customer">Customer Name</label>
                            <input type="text" id="sale-customer" required>
                        </div>
                        <div class="form-group">
                            <label for="sale-product">Product</label>
                            <select id="sale-product" required>
                                <option value="">Select Product</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="sale-quantity">Quantity</label>
                            <input type="number" id="sale-quantity" min="1" required>
                        </div>
                        <div class="form-group">
                            <label for="sale-price">Unit Price (M)</label>
                            <input type="number" id="sale-price" min="0" step="0.01" required>
                        </div>
                        <div class="form-actions">
                            <button type="button" class="btn btn-secondary" id="cancel-sale-btn">Cancel</button>
                            <button type="submit" class="btn">Record Sale</button>
                        </div>
                    </form>
                </div>
            </div>
            
            <div class="dashboard" id="finance-tab">
                <h3 style="margin-bottom: 1.5rem;">Monthly Income Statement</h3>
                
                <div class="stats">
                    <div class="stat-card">
                        <h3>Total Revenue</h3>
                        <div class="value" id="total-revenue">M 0</div>
                        <div class="subtext">Year to date</div>
                    </div>
                    <div class="stat-card">
                        <h3>Total Expenses</h3>
                        <div class="value" id="total-expenses">M 0</div>
                        <div class="subtext">Year to date</div>
                    </div>
                    <div class="stat-card">
                        <h3>Net Profit</h3>
                        <div class="value" id="net-profit">M 0</div>
                        <div class="subtext">Year to date</div>
                    </div>
                    <div class="stat-card">
                        <h3>Profit Margin</h3>
                        <div class="value" id="profit-margin">0%</div>
                        <div class="subtext">Average</div>
                    </div>
                </div>
                
                <div class="table-responsive">
                    <table id="income-statement-table">
                        <thead>
                            <tr>
                                <th>Month</th>
                                <th>Revenue</th>
                                <th>Cost of Goods</th>
                                <th>Gross Profit</th>
                                <th>Expenses</th>
                                <th>Net Profit</th>
                            </tr>
                        </thead>
                        <tbody id="income-statement-body">
                            <!-- Income statement data will be added here dynamically -->
                        </tbody>
                    </table>
                </div>
                
                <div style="margin-top: 2rem;">
                    <h3>Expense Breakdown</h3>
                    <div class="table-responsive">
                        <table id="expenses-table">
                            <thead>
                                <tr>
                                    <th>Category</th>
                                    <th>Amount</th>
                                    <th>% of Expenses</th>
                                </tr>
                            </thead>
                            <tbody id="expenses-body">
                                <!-- Expenses data will be added here dynamically -->
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <div style="margin-top: 2rem; display: flex; gap: 1rem;">
                    <button class="btn btn-info" id="export-finance">Export to Excel</button>
                    <button class="btn btn-secondary" id="print-finance">Print Statement</button>
                </div>
            </div>
            
            <div class="dashboard" id="add-tab">
                <form id="product-form">
                    <div class="form-group">
                        <label for="product-name">Product Name</label>
                        <input type="text" id="product-name" required>
                    </div>
                    <div class="form-group">
                        <label for="product-category">Category</label>
                        <select id="product-category" required>
                            <option value="">Select Category</option>
                            <option value="RAM">RAM</option>
                            <option value="Storage">Storage</option>
                            <option value="Components">Components</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="product-description">Description</label>
                        <textarea id="product-description"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="product-quantity">Quantity</label>
                        <input type="number" id="product-quantity" min="0" required>
                    </div>
                    <div class="form-group">
                        <label for="product-price">Price (M)</label>
                        <input type="number" id="product-price" min="0" step="0.01" required>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" id="cancel-product-btn">Cancel</button>
                        <button type="submit" class="btn">Save Product</button>
                    </div>
                </form>
            </div>
            
            <div class="dashboard" id="reports-tab">
                <div class="stats">
                    <div class="stat-card">
                        <h3>Monthly Revenue</h3>
                        <div class="value">M 12,450</div>
                        <div class="subtext">Current month</div>
                    </div>
                    <div class="stat-card">
                        <h3>Monthly Expenses</h3>
                        <div class="value">M 8,230</div>
                        <div class="subtext">Current month</div>
                    </div>
                    <div class="stat-card">
                        <h3>Profit</h3>
                        <div class="value">M 4,220</div>
                        <div class="subtext">Current month</div>
                    </div>
                    <div class="stat-card">
                        <h3>Recycling Volume</h3>
                        <div class="value">85 kg</div>
                        <div class="subtext">This month</div>
                    </div>
                </div>
                
                <h3 style="margin: 2rem 0 1rem;">Sales by Category</h3>
                <div class="table-responsive">
                    <table>
                        <thead>
                            <tr>
                                <th>Category</th>
                                <th>Items Sold</th>
                                <th>Total Revenue</th>
                                <th>% of Total</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>RAM</td>
                                <td>45</td>
                                <td>M 15,750</td>
                                <td>45.6%</td>
                            </tr>
                            <tr>
                                <td>Storage</td>
                                <td>22</td>
                                <td>M 9,900</td>
                                <td>28.7%</td>
                            </tr>
                            <tr>
                                <td>Components</td>
                                <td>11</td>
                                <td>M 2,200</td>
                                <td>6.4%</td>
                            </tr>
                            <tr>
                                <td>Other</td>
                                <td>0</td>
                                <td>M 0</td>
                                <td>0%</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <h3 style="margin: 2rem 0 1rem;">Monthly Trends</h3>
                <div style="background-color: white; padding: 2rem; border-radius: 8px; box-shadow: 0 3px 10px rgba(0,0,0,0.1);">
                    <canvas id="sales-chart" height="300"></canvas>
                </div>
                
                <div style="margin-top: 2rem; display: flex; gap: 1rem;">
                    <button class="btn btn-info" id="export-reports">Export Reports</button>
                    <button class="btn btn-secondary" id="print-reports">Print Reports</button>
                </div>
            </div>
            
            <div class="dashboard" id="users-tab">
                <div id="developer-tools" class="hidden">
                    <h3 style="margin-bottom: 1.5rem;">Developer Tools</h3>
                    
                    <div style="background-color: #e3f2fd; padding: 1.5rem; border-radius: 8px; margin-bottom: 2rem;">
                        <h4 style="margin-bottom: 1rem;">System Health</h4>
                        
                        <div class="health-indicator">
                            <span class="health-dot health-good"></span>
                            <span>Application Status: Operational</span>
                        </div>
                        <div class="health-indicator">
                            <span class="health-dot health-good"></span>
                            <span>Database Connection: Stable</span>
                        </div>
                        <div class="health-indicator">
                            <span class="health-dot health-warning"></span>
                            <span>Storage: 78% used (Warning at 80%)</span>
                        </div>
                        <div class="health-indicator">
                            <span class="health-dot health-good"></span>
                            <span>Last Backup: Today 02:00</span>
                        </div>
                        
                        <div style="margin-top: 1.5rem;">
                            <button class="btn" id="system-check-btn">Run System Check</button>
                        </div>
                    </div>
                    
                    <div style="background-color: #e3f2fd; padding: 1.5rem; border-radius: 8px; margin-bottom: 2rem;">
                        <h4 style="margin-bottom: 1rem;">Application Configuration</h4>
                        <div class="form-group">
                            <label for="api-endpoint">API Endpoint</label>
                            <input type="text" id="api-endpoint" value="https://api.iwb.co.ls/v1">
                        </div>
                        <div class="form-group">
                            <label for="backup-frequency">Backup Frequency</label>
                            <select id="backup-frequency">
                                <option value="daily">Daily</option>
                                <option value="weekly" selected>Weekly</option>
                                <option value="monthly">Monthly</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="auto-response">Auto-Response for Queries</label>
                            <select id="auto-response">
                                <option value="enabled">Enabled</option>
                                <option value="disabled">Disabled</option>
                            </select>
                        </div>
                        <button class="btn" style="margin-top: 1rem;">Save Configuration</button>
                    </div>
                    
                    <div style="background-color: #fff8e1; padding: 1.5rem; border-radius: 8px; margin-bottom: 2rem;">
                        <h4 style="margin-bottom: 1rem;">Database Management</h4>
                        <button class="btn" style="margin-right: 1rem;" id="backup-now-btn">Backup Now</button>
                        <button class="btn btn-secondary" id="restore-backup-btn">Restore Backup</button>
                        
                        <div style="margin-top: 1rem;">
                            <h5>Recent Backups</h5>
                            <ul style="list-style-type: none; margin-top: 0.5rem;">
                                <li style="padding: 0.3rem 0;">2023-06-15 02:00 (System)</li>
                                <li style="padding: 0.3rem 0;">2023-06-14 14:30 (Manual)</li>
                                <li style="padding: 0.3rem 0;">2023-06-08 02:00 (System)</li>
                            </ul>
                        </div>
                    </div>
                    
                    <div style="background-color: #f5f5f5; padding: 1.5rem; border-radius: 8px; margin-bottom: 2rem;">
                        <h4 style="margin-bottom: 1rem;">System Logs</h4>
                        <div style="max-height: 200px; overflow-y: auto; background-color: white; padding: 1rem; border-radius: 5px; font-family: monospace; font-size: 0.9rem;">
                            <div>[2023-06-15 08:45] User login: admin@iwb.co.ls</div>
                            <div>[2023-06-15 08:30] Database backup completed</div>
                            <div>[2023-06-15 08:15] System check: All services operational</div>
                            <div>[2023-06-15 02:00] Scheduled backup completed</div>
                            <div>[2023-06-14 23:30] User logout: jane.smith@iwb.co.ls</div>
                        </div>
                        <button class="btn" style="margin-top: 1rem;">Download Full Logs</button>
                    </div>
                </div>
                
                <h3 style="margin-bottom: 1.5rem;">User Management</h3>
                <button class="btn" id="add-user-btn" style="margin-bottom: 1.5rem;">Add New User</button>
                
                <div id="user-form-container" style="display: none; margin-bottom: 2rem;">
                    <form id="user-form">
                        <div class="form-group">
                            <label for="user-name">Full Name</label>
                            <input type="text" id="user-name" required>
                        </div>
                        <div class="form-group">
                            <label for="user-email">Email</label>
                            <input type="email" id="user-email" required>
                        </div>
                        <div class="form-group">
                            <label for="user-role">Role</label>
                            <select id="user-role" required>
                                <option value="">Select Role</option>
                                <option value="admin">Administrator</option>
                                <option value="sales">Sales Personnel</option>
                                <option value="finance">Finance Personnel</option>
                                <option value="developer">Developer</option>
                                <option value="investor">Investor</option>
                                <option value="partner">Partner (IWC)</option>
                                <option value="customer">Customer</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="user-password">Password</label>
                            <input type="password" id="user-password" required minlength="8">
                        </div>
                        <div class="form-group mfa-setup">
                            <label>Multi-Factor Authentication</label>
                            <div style="margin-top: 0.5rem;">
                                <input type="checkbox" id="user-mfa" checked>
                                <label for="user-mfa" style="display: inline; margin-left: 0.5rem;">Require MFA</label>
                            </div>
                        </div>
                        <div class="form-actions">
                            <button type="button" class="btn btn-secondary" id="cancel-user-btn">Cancel</button>
                            <button type="submit" class="btn">Save User</button>
                        </div>
                    </form>
                </div>
                
                <div class="table-responsive">
                    <table id="users-table">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Email</th>
                                <th>Role</th>
                                <th>Last Login</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="users-body">
                            <!-- Users will be added here dynamically -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <div class="dashboard" id="settings-tab">
                <h3 style="margin-bottom: 1.5rem;">System Settings</h3>
                
                <form id="settings-form">
                    <div class="form-group">
                        <label for="company-name">Company Name</label>
                        <input type="text" id="company-name" value="IWB Recycling Solutions" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="company-address">Address</label>
                        <textarea id="company-address" required>123 Recycling Road, Maseru, Lesotho</textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="company-phone">Phone Number</label>
                        <input type="text" id="company-phone" value="+266 1234 5678" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="company-email">Contact Email</label>
                        <input type="email" id="company-email" value="info@iwb.co.ls" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="business-hours">Business Hours</label>
                        <input type="text" id="business-hours" value="Mon-Fri: 8AM - 5PM" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="default-currency">Default Currency</label>
                        <select id="default-currency" required>
                            <option value="M" selected>Maloti (M)</option>
                            <option value="$">Dollar ($)</option>
                            <option value="€">Euro (€)</option>
                            <option value="£">Pound (£)</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="auto-response-setting">Customer Query Auto-Response</label>
                        <select id="auto-response-setting">
                            <option value="enabled">Enabled</option>
                            <option value="disabled">Disabled</option>
                        </select>
                    </div>
                    
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" id="cancel-settings-btn">Cancel</button>
                        <button type="submit" class="btn">Save Settings</button>
                    </div>
                </form>
            </div>
        </div>
    </section>

    <section id="queries" class="section hidden">
        <div class="container">
            <h2 class="section-title">Customer Queries</h2>
            
            <div id="queries-access-denied" class="access-denied hidden">
                <h3>Access Denied</h3>
                <p>You don't have permission to access customer queries.</p>
            </div>
            
            <div id="queries-content">
                <div class="stats">
                    <div class="stat-card">
                        <h3>Total Queries</h3>
                        <div class="value" id="total-queries">0</div>
                        <div class="subtext">All time</div>
                    </div>
                    <div class="stat-card">
                        <h3>Pending</h3>
                        <div class="value" id="pending-queries">0</div>
                        <div class="subtext">Require response</div>
                    </div>
                    <div class="stat-card">
                        <h3>Completed</h3>
                        <div class="value" id="completed-queries">0</div>
                        <div class="subtext">Resolved</div>
                    </div>
                    <div class="stat-card">
                        <h3>Auto-Responded</h3>
                        <div class="value" id="auto-queries">0</div>
                        <div class="subtext">System responses</div>
                    </div>
                </div>
                
                <div style="display: flex; justify-content: space-between; margin-bottom: 1.5rem;">
                    <button class="btn" id="new-query-btn">New Query</button>
                    <div>
                        <input type="text" id="query-search" placeholder="Search queries..." style="padding: 0.5rem; border: 1px solid #ddd; border-radius: 5px;">
                    </div>
                </div>
                
                <div id="query-form-container" style="display: none; margin-bottom: 2rem;">
                    <form id="query-form">
                        <div class="form-group">
                            <label for="query-customer-name">Customer Name</label>
                            <input type="text" id="query-customer-name" required>
                        </div>
                        <div class="form-group">
                            <label for="query-customer-email">Email</label>
                            <input type="email" id="query-customer-email" required>
                        </div>
                        <div class="form-group">
                            <label for="query-message">Message</label>
                            <textarea id="query-message" required></textarea>
                        </div>
                        <div class="form-actions">
                            <button type="button" class="btn btn-secondary" id="cancel-query-btn">Cancel</button>
                            <button type="submit" class="btn">Submit Query</button>
                        </div>
                    </form>
                </div>
                
                <div class="table-responsive">
                    <table id="queries-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Date</th>
                                <th>Customer</th>
                                <th>Email</th>
                                <th>Message</th>
                                <th>Status</th>
                                <th>Response</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="queries-body">
                            <!-- Queries will be added here dynamically -->
                        </tbody>
                    </table>
                </div>
                
                <div id="query-detail-modal" class="modal">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h3>Query Details</h3>
                            <button class="close-modal" id="close-query-modal">&times;</button>
                        </div>
                        <div id="query-detail-content">
                            <!-- Query details will be loaded here -->
                        </div>
                        <div style="margin-top: 2rem;">
                            <h4>Response</h4>
                            <textarea id="query-response-text" style="width: 100%; min-height: 100px; padding: 0.8rem; border: 1px solid #ddd; border-radius: 5px; margin-bottom: 1rem;"></textarea>
                            <div class="form-actions">
                                <button type="button" class="btn btn-secondary" id="cancel-response-btn">Cancel</button>
                                <button type="button" class="btn" id="send-response-btn">Send Response</button>
                                <button type="button" class="btn" id="mark-complete-btn" style="margin-left: auto;">Mark as Complete</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section id="inbox" class="section hidden">
        <div class="container">
            <h2 class="section-title">My Inbox</h2>
            
            <div class="customer-inbox">
                <h3>Your Queries and Responses</h3>
                <div id="inbox-content">
                    <!-- Customer queries and responses will be loaded here -->
                </div>
            </div>
            
            <button class="btn" id="new-inbox-query-btn" style="margin-top: 1rem;">Create New Query</button>
        </div>
    </section>

    <section id="investor" class="section hidden">
        <div class="container">
            <h2 class="section-title">Investor Portal</h2>
            
            <div id="investor-access-denied" class="access-denied hidden">
                <h3>Access Denied</h3>
                <p>You don't have permission to access the investor portal.</p>
            </div>
            
            <div id="investor-content">
                <div class="stats">
                    <div class="stat-card">
                        <h3>Company Valuation</h3>
                        <div class="value">M 5.2M</div>
                        <div class="subtext">Current estimate</div>
                    </div>
                    <div class="stat-card">
                        <h3>Monthly Revenue</h3>
                        <div class="value">M 124,500</div>
                        <div class="subtext">Annualized: M 1.49M</div>
                    </div>
                    <div class="stat-card">
                        <h3>Profit Margin</h3>
                        <div class="value">34.5%</div>
                        <div class="subtext">Industry avg: 28%</div>
                    </div>
                    <div class="stat-card">
                        <h3>Growth Rate</h3>
                        <div class="value">12.8%</div>
                        <div class="subtext">Quarter over quarter</div>
                    </div>
                </div>
                
                <h3 style="margin: 2rem 0 1rem;">Financial Performance</h3>
                <div style="background-color: white; padding: 2rem; border-radius: 8px; box-shadow: 0 3px 10px rgba(0,0,0,0.1);">
                    <canvas id="investor-chart" height="300"></canvas>
                </div>
                
                <h3 style="margin: 2rem 0 1rem;">Investment Opportunities</h3>
                <div class="services">
                    <div class="service-card">
                        <img src="https://images.unsplash.com/photo-1551288049-bebda4e38f71?ixlib=rb-1.2.1&auto=format&fit=crop&w=1350&q=80" alt="Expansion">
                        <div class="service-content">
                            <h3>Regional Expansion</h3>
                            <p>Help fund our expansion into new markets in Southern Africa with projected 3x ROI within 24 months.</p>
                            <button class="btn btn-investor" style="margin-top: 1rem;">View Details</button>
                        </div>
                    </div>
                    <div class="service-card">
                        <img src="https://images.unsplash.com/photo-1518770660439-4636190af475?ixlib=rb-1.2.1&auto=format&fit=crop&w=1350&q=80" alt="Technology">
                        <div class="service-content">
                            <h3>Technology Upgrade</h3>
                            <p>Invest in our new recycling technology with 5-year revenue sharing agreement.</p>
                            <button class="btn btn-investor" style="margin-top: 1rem;">View Details</button>
                        </div>
                    </div>
                    <div class="service-card">
                        <img src="https://images.unsplash.com/photo-1454165804606-c3d57bc86b40?ixlib=rb-1.2.1&auto=format&fit=crop&w=1350&q=80" alt="Facility">
                        <div class="service-content">
                            <h3>New Facility</h3>
                            <p>Capital investment opportunity in our new state-of-the-art recycling facility.</p>
                            <button class="btn btn-investor" style="margin-top: 1rem;">View Details</button>
                        </div>
                    </div>
                </div>
                
                <div style="margin-top: 2rem;">
                    <h3>Recent Investor Updates</h3>
                    <div style="background-color: white; padding: 1.5rem; border-radius: 8px; box-shadow: 0 3px 10px rgba(0,0,0,0.1); margin-top: 1rem;">
                        <div style="margin-bottom: 1rem; padding-bottom: 1rem; border-bottom: 1px solid #eee;">
                            <h4 style="color: var(--investor-color);">Q2 2023 Financial Results</h4>
                            <p style="margin: 0.5rem 0; color: #666;">Posted: June 15, 2023</p>
                            <p>Our Q2 results show continued growth with revenue up 12% quarter-over-quarter...</p>
                            <button class="btn btn-investor" style="margin-top: 0.5rem;">Read Full Report</button>
                        </div>
                        <div>
                            <h4 style="color: var(--investor-color);">New Partnership Announcement</h4>
                            <p style="margin: 0.5rem 0; color: #666;">Posted: June 5, 2023</p>
                            <p>We're excited to announce a new partnership with IWC to expand our operations...</p>
                            <button class="btn btn-investor" style="margin-top: 0.5rem;">Read Announcement</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section id="contact" class="section hidden">
        <div class="container">
            <h2 class="section-title">Contact Us</h2>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
                <div>
                    <h3 style="margin-bottom: 1rem;">Our Location</h3>
                    <p style="margin-bottom: 1.5rem;">123 Recycling Road<br>Maseru, Lesotho<br>100</p>
                    
                    <h3 style="margin-bottom: 1rem;">Contact Information</h3>
                    <p style="margin-bottom: 0.5rem;"><strong>Phone:</strong> +266 1234 5678</p>
                    <p style="margin-bottom: 0.5rem;"><strong>Email:</strong> info@iwb.co.ls</p>
                    <p><strong>Hours:</strong> Mon-Fri: 8AM - 5PM</p>
                </div>
                
                <div>
                    <h3 style="margin-bottom: 1rem;">Send Us a Message</h3>
                    <form id="contact-form">
                        <div class="form-group">
                            <label for="contact-name">Your Name</label>
                            <input type="text" id="contact-name" required>
                        </div>
                        <div class="form-group">
                            <label for="contact-email">Email</label>
                            <input type="email" id="contact-email" required>
                        </div>
                        <div class="form-group">
                            <label for="contact-subject">Subject</label>
                            <input type="text" id="contact-subject" required>
                        </div>
                        <div class="form-group">
                            <label for="contact-message">Message</label>
                            <textarea id="contact-message" required></textarea>
                        </div>
                        <div class="form-actions">
                            <button type="submit" class="btn">Send Message</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </section>

    <footer id="main-footer" class="hidden">
        <div class="footer-content">
            <div class="footer-section">
                <h3>About IWB</h3>
                <p>Pioneering electronic waste recycling in Southern Africa with sustainable solutions and innovative approaches to e-waste management.</p>
            </div>
            <div class="footer-section">
                <h3>Quick Links</h3>
                <ul style="list-style: none;">
                    <li style="margin-bottom: 0.5rem;"><a href="#" class="nav-link" data-section="home" style="color: white; text-decoration: none;">Home</a></li>
                    <li style="margin-bottom: 0.5rem;"><a href="#" class="nav-link" data-section="services" style="color: white; text-decoration: none;">Services</a></li>
                    <li style="margin-bottom: 0.5rem;"><a href="#" class="nav-link" data-section="products" style="color: white; text-decoration: none;">Products</a></li>
                    <li><a href="#" class="nav-link" data-section="contact" style="color: white; text-decoration: none;">Contact</a></li>
                </ul>
            </div>
            <div class="footer-section">
                <h3>Connect With Us</h3>
                <div class="social-icons">
                    <a href="#"><i class="fab fa-facebook"></i></a>
                    <a href="#"><i class="fab fa-twitter"></i></a>
                    <a href="#"><i class="fab fa-linkedin"></i></a>
                    <a href="#"><i class="fab fa-instagram"></i></a>
                </div>
            </div>
        </div>
        <div class="copyright">
            <p>&copy; 2023 IWB Recycling Solutions. All Rights Reserved.</p>
        </div>
    </footer>

    <!-- Font Awesome for icons -->
    <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
    
    <!-- Chart.js for reports -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Papa Parse for CSV export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    
    <script>
        // Data storage
        const appData = {
            currentUser: null,
            products: [],
            queries: [],
            sales: [],
            users: [
                { id: 1, name: 'Admin User', email: 'admin@iwb.co.ls', password: 'admin123', role: 'admin', lastLogin: new Date().toISOString(), status: 'Active', mfa: true },
                { id: 2, name: 'Investor User', email: 'investor@iwb.co.ls', password: 'investor123', role: 'investor', lastLogin: new Date().toISOString(), status: 'Active', mfa: false }
            ],
            incomeStatements: [
                { month: 'January', revenue: 8500, costOfGoods: 4200, expenses: 2000 },
                { month: 'February', revenue: 9200, costOfGoods: 4500, expenses: 2300 },
                { month: 'March', revenue: 10100, costOfGoods: 5000, expenses: 2200 },
                { month: 'April', revenue: 12450, costOfGoods: 6200, expenses: 2030 },
                { month: 'May', revenue: 11800, costOfGoods: 5900, expenses: 2000 },
                { month: 'June', revenue: 13200, costOfGoods: 6600, expenses: 1900 },
                { month: 'July', revenue: 14500, costOfGoods: 7200, expenses: 1900 }
            ],
            autoResponseEnabled: true,
            loadData: function() {
                const savedData = localStorage.getItem('iwbData');
                if (savedData) {
                    const parsedData = JSON.parse(savedData);
                    this.products = parsedData.products || [];
                    this.queries = parsedData.queries || [];
                    this.sales = parsedData.sales || [];
                    // Ensure admin user always exists
                    const adminExists = parsedData.users && parsedData.users.some(u => u.role === 'admin');
                    const investorExists = parsedData.users && parsedData.users.some(u => u.role === 'investor');
                    this.users = adminExists ? parsedData.users : this.users;
                    if (!investorExists) {
                        this.users.push({ id: 2, name: 'Investor User', email: 'investor@iwb.co.ls', password: 'investor123', role: 'investor', lastLogin: new Date().toISOString(), status: 'Active', mfa: false });
                    }
                    this.incomeStatements = parsedData.incomeStatements || this.incomeStatements;
                    this.autoResponseEnabled = parsedData.autoResponseEnabled !== undefined ? parsedData.autoResponseEnabled : true;
                }
            },
            saveData: function() {
                const dataToSave = {
                    products: this.products,
                    queries: this.queries,
                    sales: this.sales,
                    users: this.users,
                    incomeStatements: this.incomeStatements,
                    autoResponseEnabled: this.autoResponseEnabled
                };
                localStorage.setItem('iwbData', JSON.stringify(dataToSave));
            },
            initSampleData: function() {
                if (this.products.length === 0) {
                    this.products = [
                        { id: 1, name: 'DDR4 RAM 8GB', category: 'RAM', description: '8GB DDR4 2400MHz', quantity: 15, price: 350, status: 'In Stock' },
                        { id: 2, name: 'Refurbished 1TB HDD', category: 'Storage', description: '7200 RPM SATA', quantity: 8, price: 450, status: 'In Stock' },
                        { id: 3, name: 'Motherboard Components Kit', category: 'Components', description: 'Various reusable components', quantity: 25, price: 200, status: 'In Stock' },
                        { id: 4, name: 'Refurbished Laptop RAM', category: 'RAM', description: '4GB DDR3 SODIMM', quantity: 3, price: 250, status: 'Low Stock' }
                    ];
                }
                
                if (this.queries.length === 0) {
                    this.queries = [
                        { id: 5001, date: new Date('2023-05-10').toISOString(), customer: 'David Wilson', email: 'david@example.com', message: 'Do you offer bulk discounts for RAM purchases?', status: 'Completed', response: 'Yes, we offer discounts for orders over 10 units. Please contact our sales team for details.', autoResponded: false },
                        { id: 5002, date: new Date('2023-05-15').toISOString(), customer: 'Lisa Taylor', email: 'lisa@example.com', message: 'What is your warranty policy for refurbished hard drives?', status: 'Completed', response: 'All refurbished hard drives come with a 1-year warranty covering manufacturing defects.', autoResponded: this.autoResponseEnabled },
                        { id: 5003, date: new Date('2023-05-18').toISOString(), customer: 'Mark Anderson', email: 'mark@example.com', message: 'Do you accept electronic waste for recycling from individuals?', status: 'Pending', response: '', autoResponded: false }
                    ];
                }
                
                if (this.sales.length === 0) {
                    this.sales = [
                        { id: 1001, date: new Date('2023-05-15').toISOString(), customer: 'ABC Corp', productId: 1, productName: 'DDR4 RAM 8GB', quantity: 5, price: 350, total: 1750, status: 'Completed', salesPerson: 'John Doe' },
                        { id: 1002, date: new Date('2023-05-18').toISOString(), customer: 'XYZ Ltd', productId: 2, productName: 'Refurbished 1TB HDD', quantity: 3, price: 450, total: 1350, status: 'Completed', salesPerson: 'Jane Smith' },
                        { id: 1003, date: new Date('2023-05-20').toISOString(), customer: 'Tech Solutions', productId: 3, productName: 'Motherboard Components Kit', quantity: 10, price: 200, total: 2000, status: 'Pending', salesPerson: 'John Doe' }
                    ];
                }
                
                this.saveData();
            },
            addProduct: function(product) {
                // Only admin and sales can add products
                if (this.currentUser && !['admin', 'sales'].includes(this.currentUser.role)) {
                    return { error: 'You do not have permission to add products' };
                }
                
                product.id = this.products.length > 0 ? Math.max(...this.products.map(p => p.id)) + 1 : 1;
                this.products.push(product);
                this.saveData();
                return product;
            },
            updateProduct: function(id, updatedProduct) {
                // Only admin and sales can update products
                if (this.currentUser && !['admin', 'sales'].includes(this.currentUser.role)) {
                    return { error: 'You do not have permission to update products' };
                }
                
                const index = this.products.findIndex(p => p.id === id);
                if (index !== -1) {
                    this.products[index] = { ...this.products[index], ...updatedProduct };
                    this.saveData();
                    return true;
                }
                return false;
            },
            deleteProduct: function(id) {
                // Only admin can delete products
                if (this.currentUser && this.currentUser.role !== 'admin') {
                    return { error: 'You do not have permission to delete products' };
                }
                
                const index = this.products.findIndex(p => p.id === id);
                if (index !== -1) {
                    this.products.splice(index, 1);
                    this.saveData();
                    return true;
                }
                return false;
            },
            addQuery: function(query) {
    query.id = this.queries.length > 0 ? Math.max(...this.queries.map(q => q.id)) + 1 : 1;
    query.date = new Date().toISOString();
    query.status = 'Pending';
    query.response = '';
    query.autoResponded = false;
    
    // Auto-response only if enabled
    if (this.autoResponseEnabled) {
        const similarQuery = this.queries.find(q => 
            q.message.toLowerCase().includes(query.message.toLowerCase().substring(0, 20)) && 
            q.response
        );
        
        if (similarQuery) {
            query.response = similarQuery.response;
            query.status = 'Completed';
            query.autoResponded = true;
            
            // Show alert to user that auto-response was sent
            showAlert('Your query has been automatically responded to based on similar previous queries', 'info');
        }
    }
    
    this.queries.push(query);
    this.saveData();
    this.updateQueryBadges();
    return query;
},
            updateQuery: function(id, updatedQuery) {
                const index = this.queries.findIndex(q => q.id === id);
                if (index !== -1) {
                    this.queries[index] = { ...this.queries[index], ...updatedQuery };
                    this.saveData();
                    
                    // Update badge count for admin/sales
                    this.updateQueryBadges();
                    
                    return true;
                }
                return false;
            },
            // In the appData object, add this method:
deleteQuery: function(id) {
    // Only admin and developer can delete queries
    if (this.currentUser && !['admin', 'developer'].includes(this.currentUser.role)) {
        return { error: 'You do not have permission to delete queries' };
    }
    
    const index = this.queries.findIndex(q => q.id === id);
    if (index !== -1) {
        this.queries.splice(index, 1);
        this.saveData();
        this.updateQueryBadges();
        return true;
    }
    return false;
},
            addSale: function(sale) {
                // Only admin and sales can add sales
                if (this.currentUser && !['admin', 'sales'].includes(this.currentUser.role)) {
                    return { error: 'You do not have permission to record sales' };
                }
                
                sale.id = this.sales.length > 0 ? Math.max(...this.sales.map(s => s.id)) + 1 : 1;
                sale.date = new Date().toISOString();
                sale.status = 'Completed';
                sale.salesPerson = this.currentUser.name || this.currentUser.email;
                
                // Update product quantity
                const product = this.products.find(p => p.id === sale.productId);
                if (product) {
                    product.quantity -= sale.quantity;
                    if (product.quantity < 5) {
                        product.status = 'Low Stock';
                    }
                    if (product.quantity <= 0) {
                        product.status = 'Out of Stock';
                    }
                }
                
                this.sales.push(sale);
                this.saveData();
                return sale;
            },
            deleteSale: function(id) {
                // Only admin and sales can delete sales
                if (this.currentUser && !['admin', 'sales'].includes(this.currentUser.role)) {
                    return { error: 'You do not have permission to delete sales' };
                }
                
                const index = this.sales.findIndex(s => s.id === id);
                if (index !== -1) {
                    this.sales.splice(index, 1);
                    this.saveData();
                    return true;
                }
                return false;
            },
            bulkDeleteSales: function(ids) {
                // Only admin and sales can delete sales
                if (this.currentUser && !['admin', 'sales'].includes(this.currentUser.role)) {
                    return { error: 'You do not have permission to delete sales' };
                }
                
                const initialCount = this.sales.length;
                this.sales = this.sales.filter(sale => !ids.includes(sale.id));
                this.saveData();
                return initialCount - this.sales.length;
            },
            addUser: function(user) {
                // Only admin and developer can add users
                if (this.currentUser && !['admin', 'developer'].includes(this.currentUser.role)) {
                    return { error: 'You do not have permission to add users' };
                }
                
                // Enforce maximum user limits for certain roles
                const currentSalesCount = this.users.filter(u => u.role === 'sales').length;
                const currentFinanceCount = this.users.filter(u => u.role === 'finance').length;
                const currentDeveloperCount = this.users.filter(u => u.role === 'developer').length;
                
                if (user.role === 'sales' && currentSalesCount >= 5) {
                    return { error: 'Maximum of 5 sales personnel already reached' };
                }
                
                if (user.role === 'finance' && currentFinanceCount >= 3) {
                    return { error: 'Maximum of 3 finance personnel already reached' };
                }
                
                if (user.role === 'developer' && currentDeveloperCount >= 2) {
                    return { error: 'Maximum of 2 developers already reached' };
                }
                
                user.id = this.users.length > 0 ? Math.max(...this.users.map(u => u.id)) + 1 : 1;
                user.lastLogin = new Date().toISOString();
                user.status = 'Active';
                this.users.push(user);
                this.saveData();
                return user;
            },
            updateUser: function(id, updatedUser) {
                // Only admin and developer can update users
                if (this.currentUser && !['admin', 'developer'].includes(this.currentUser.role)) {
                    return { error: 'You do not have permission to update users' };
                }
                
                const index = this.users.findIndex(u => u.id === id);
                if (index !== -1) {
                    // Don't allow changing admin user's role
                    if (this.users[index].role === 'admin' && updatedUser.role && updatedUser.role !== 'admin') {
                        return { error: 'Cannot change admin user role' };
                    }
                    
                    this.users[index] = { ...this.users[index], ...updatedUser };
                    this.saveData();
                    return true;
                }
                return false;
            },
            deleteUser: function(id) {
                // Only admin and developer can delete users
                if (this.currentUser && !['admin', 'developer'].includes(this.currentUser.role)) {
                    return { error: 'You do not have permission to delete users' };
                }
                
                const index = this.users.findIndex(u => u.id === id);
                if (index !== -1) {
                    // Don't allow deleting admin user
                    if (this.users[index].role === 'admin') {
                        return { error: 'Cannot delete admin user' };
                    }
                    
                    this.users.splice(index, 1);
                    this.saveData();
                    return true;
                }
                return false;
            },
            authenticateUser: function(email, password, role) {
                const user = this.users.find(u => u.email === email && u.password === password);
                if (user) {
                    // Check if role matches (customer can only login as customer, employee roles can login as employee, investor as investor)
                    if ((role === 'customer' && user.role === 'customer') || 
                        (role === 'employee' && ['admin', 'sales', 'finance', 'developer', 'partner'].includes(user.role)) ||
                        (role === 'investor' && user.role === 'investor')) {
                        this.currentUser = { ...user };
                        this.currentUser.lastLogin = new Date().toISOString();
                        return true;
                    }
                }
                return false;
            },
            logout: function() {
                this.currentUser = null;
            },
            getQueriesByEmail: function(email) {
                return this.queries.filter(q => q.email === email);
            },
            updateQueryBadges: function() {
                if (!this.currentUser) return;
                
                const pendingQueries = this.queries.filter(q => q.status === 'Pending').length;
                
                // Update nav badge for admin/sales
                if (['admin', 'sales'].includes(this.currentUser.role)) {
                    const queriesBadge = document.getElementById('queries-badge');
                    if (pendingQueries > 0) {
                        queriesBadge.textContent = pendingQueries;
                        queriesBadge.classList.remove('hidden');
                    } else {
                        queriesBadge.classList.add('hidden');
                    }
                }
                
                // Update nav badge for customer
                if (this.currentUser.role === 'customer') {
                    const customerPending = this.getQueriesByEmail(this.currentUser.email).filter(q => q.status === 'Pending').length;
                    const inboxBadge = document.getElementById('inbox-badge');
                    if (customerPending > 0) {
                        inboxBadge.textContent = customerPending;
                        inboxBadge.classList.remove('hidden');
                    } else {
                        inboxBadge.classList.add('hidden');
                    }
                }
            },
            // Check if user has permission to access a section
            hasPermission: function(section) {
                if (!this.currentUser) return false;
                
                const role = this.currentUser.role;
                
                switch(section) {
                    case 'dashboard':
                        return ['admin', 'sales', 'finance', 'developer', 'partner'].includes(role);
                    case 'queries':
                        return ['admin', 'sales'].includes(role);
                    case 'inbox':
                        return role === 'customer';
                    case 'investor':
                        return role === 'investor';
                    case 'finance':
                        return ['admin', 'finance', 'partner'].includes(role);
                    case 'sales':
                        return ['admin', 'sales'].includes(role);
                    case 'developer':
                        return role === 'developer';
                    case 'add-product':
                        return ['admin', 'sales'].includes(role);
                    case 'settings':
                        return ['admin', 'developer'].includes(role);
                    default:
                        return true;
                }
            },
            // Backup data to a file
            backupData: function() {
                const data = {
                    products: this.products,
                    queries: this.queries,
                    sales: this.sales,
                    users: this.users,
                    incomeStatements: this.incomeStatements,
                    timestamp: new Date().toISOString()
                };
                
                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `iwb-backup-${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                return true;
            },
            // Toggle auto-response setting
            toggleAutoResponse: function(enabled) {
                this.autoResponseEnabled = enabled;
                this.saveData();
                return true;
            }
        };

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            // Load data from localStorage
            appData.loadData();
            appData.initSampleData();
            
            // Show login section by default
            showSection('login');
            
            // Role selection
            document.querySelectorAll('.role-btn').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.preventDefault();
                    document.querySelectorAll('.role-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Show/hide employee role selector and MFA based on role
                    const role = this.getAttribute('data-role');
                    if (role === 'employee') {
                        document.getElementById('employee-role-selector').classList.remove('hidden');
                        document.getElementById('mfa-section').classList.remove('hidden');
                        document.getElementById('login-mfa').setAttribute('required', '');
                    } else if (role === 'investor') {
                        document.getElementById('employee-role-selector').classList.add('hidden');
                        document.getElementById('mfa-section').classList.add('hidden');
                        document.getElementById('login-mfa').removeAttribute('required');
                    } else {
                        document.getElementById('employee-role-selector').classList.add('hidden');
                        document.getElementById('mfa-section').classList.add('hidden');
                        document.getElementById('login-mfa').removeAttribute('required');
                    }
                });
            });
            
            // Show registration form
            document.getElementById('show-register').addEventListener('click', function(e) {
                e.preventDefault();
                document.getElementById('login').classList.add('hidden');
                document.getElementById('register').classList.remove('hidden');
            });
            
            // Cancel registration
            document.getElementById('cancel-register').addEventListener('click', function() {
                document.getElementById('register').classList.add('hidden');
                document.getElementById('login').classList.remove('hidden');
            });
            
            // Registration form submission
            document.getElementById('register-form').addEventListener('submit', function(e) {
                e.preventDefault();
                const name = document.getElementById('register-name').value;
                const email = document.getElementById('register-email').value;
                const password = document.getElementById('register-password').value;
                const confirm = document.getElementById('register-confirm').value;
                
                if (password !== confirm) {
                    showAlert('Passwords do not match', 'error', 'register-alert');
                    return;
                }
                
                if (password.length < 8) {
                    showAlert('Password must be at least 8 characters', 'error', 'register-alert');
                    return;
                }
                
                if (appData.users.some(u => u.email === email)) {
                    showAlert('Email already registered', 'error', 'register-alert');
                    return;
                }
                
                const newUser = {
                    name: name,
                    email: email,
                    password: password,
                    role: 'customer',
                    mfa: false
                };
                
                const result = appData.addUser(newUser);
                if (result.error) {
                    showAlert(result.error, 'error', 'register-alert');
                    return;
                }
                
                showAlert('Registration successful! Please login', 'success', 'register-alert');
                
                // Reset form and show login
                this.reset();
                setTimeout(() => {
                    document.getElementById('register').classList.add('hidden');
                    document.getElementById('login').classList.remove('hidden');
                }, 1500);
            });
            
            // Login form submission
            document.getElementById('login-form').addEventListener('submit', function(e) {
                e.preventDefault();
                const email = document.getElementById('login-email').value;
                const password = document.getElementById('login-password').value;
                const mfa = document.getElementById('login-mfa').value;
                const selectedRoleBtn = document.querySelector('.role-btn.active');
                
                if (!selectedRoleBtn) {
                    showAlert('Please select a role (Customer, IWB Employee, or Investor)', 'error');
                    return;
                }
                
                const role = selectedRoleBtn.getAttribute('data-role');
                
                // Simple validation
                if (!email || !password) {
                    showAlert('Please enter both email and password', 'error');
                    return;
                }
                
                if (role === 'employee' && (!mfa || mfa.length !== 6)) {
                    showAlert('Please enter a valid 6-digit MFA code', 'error');
                    return;
                }
                
                // Authenticate user
                if (appData.authenticateUser(email, password, role)) {
                    // Successful login
                    showAlert('Login successful! Redirecting...', 'success');
                    
                    // Show main header and footer
                    document.getElementById('main-header').classList.remove('hidden');
                    document.getElementById('main-footer').classList.remove('hidden');
                    
                    // Update user info in header
                    document.getElementById('username-display').textContent = appData.currentUser.name || appData.currentUser.email;
                    
                    // Update navigation based on role
                    updateNavigation();
                    
                    // Show home section by default
                    showSection('home');
                    
                    // Hide login section
                    document.getElementById('login').classList.add('hidden');
                    
                    // Reset login form
                    document.getElementById('login-form').reset();
                    document.querySelectorAll('.role-btn').forEach(b => b.classList.remove('active'));
                    document.getElementById('employee-role-selector').classList.add('hidden');
                    document.getElementById('mfa-section').classList.add('hidden');
                } else {
                    showAlert('Invalid credentials or role mismatch', 'error');
                }
            });
            
            // Logout functionality
            document.getElementById('logout-btn').addEventListener('click', function() {
                appData.logout();
                
                // Hide main header and footer
                document.getElementById('main-header').classList.add('hidden');
                document.getElementById('main-footer').classList.add('hidden');
                
                // Reset login form
                document.getElementById('login-form').reset();
                document.querySelectorAll('.role-btn').forEach(b => b.classList.remove('active'));
                
                // Show login page
                showSection('login');
                
                // Hide all other sections
                document.querySelectorAll('.section').forEach(section => {
                    if (section.id !== 'login') {
                        section.classList.add('hidden');
                    }
                });
            });
            
            // Navigation links
            document.querySelectorAll('.nav-link').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const section = this.getAttribute('data-section');
                    
                    // Check permissions before showing section
                    if (appData.currentUser && !appData.hasPermission(section)) {
                        showAlert('You do not have permission to access this section', 'error');
                        return;
                    }
                    
                    showSection(section);
                    
                    // If dashboard, show inventory tab by default
                    if (section === 'dashboard') {
                        showTab('inventory');
                    }
                    
                    // Scroll to top
                    window.scrollTo(0, 0);
                });
            });
            
            // Tab functionality
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabId = this.getAttribute('data-tab');
                    
                    // Check permissions before showing tab
                    if (appData.currentUser) {
                        if (tabId === 'finance' && !appData.hasPermission('finance')) {
                            showAlert('You do not have permission to access financial data', 'error');
                            return;
                        }
                        
                        if (tabId === 'sales' && !appData.hasPermission('sales')) {
                            showAlert('You do not have permission to access sales data', 'error');
                            return;
                        }
                        
                        if (tabId === 'users' && !['admin', 'developer'].includes(appData.currentUser.role)) {
                            showAlert('You do not have permission to manage users', 'error');
                            return;
                        }
                        
                        if (tabId === 'add' && !appData.hasPermission('add-product')) {
                            showAlert('You do not have permission to add products', 'error');
                            return;
                        }
                    }
                    
                    showTab(tabId);
                });
            });
            
            // Product form submission
            document.getElementById('product-form').addEventListener('submit', function(e) {
                e.preventDefault();
                const productId = this.getAttribute('data-product-id');
                const productData = {
                    name: document.getElementById('product-name').value,
                    category: document.getElementById('product-category').value,
                    description: document.getElementById('product-description').value,
                    quantity: parseInt(document.getElementById('product-quantity').value),
                    price: parseFloat(document.getElementById('product-price').value),
                    status: parseInt(document.getElementById('product-quantity').value) < 5 ? 'Low Stock' : 'In Stock'
                };
                
                if (productId) {
                    // Update existing product
                    const updated = appData.updateProduct(parseInt(productId), productData);
                    if (updated === true) {
                        showAlert(`Product "${productData.name}" updated successfully!`, 'success');
                        this.reset();
                        this.removeAttribute('data-product-id');
                        this.querySelector('button[type="submit"]').textContent = 'Save Product';
                        loadDashboardData();
                    } else if (updated && updated.error) {
                        showAlert(updated.error, 'error');
                    }
                } else {
                    // Add new product
                    const addedProduct = appData.addProduct(productData);
                    if (addedProduct.error) {
                        showAlert(addedProduct.error, 'error');
                        return;
                    }
                    showAlert(`Product "${addedProduct.name}" added successfully!`, 'success');
                    this.reset();
                    loadDashboardData();
                }
            });
            
            // Cancel product edit
            document.getElementById('cancel-product-btn').addEventListener('click', function() {
                document.getElementById('product-form').reset();
                document.getElementById('product-form').removeAttribute('data-product-id');
                document.getElementById('product-form').querySelector('button[type="submit"]').textContent = 'Save Product';
            });
            
            // Query form submission
            document.getElementById('query-form').addEventListener('submit', function(e) {
    e.preventDefault();
    const query = {
        customer: document.getElementById('query-customer-name').value,
        email: document.getElementById('query-customer-email').value,
        message: document.getElementById('query-message').value
    };
    
    const addedQuery = appData.addQuery(query);
    
    if (addedQuery.autoResponded) {
        showAlert('Your query has been automatically answered based on similar previous queries', 'info');
    } else {
        showAlert('Your query has been submitted! Our team will respond shortly.', 'success');
    }
    
    this.reset();
    document.getElementById('query-form-container').style.display = 'none';
    loadDashboardData();
                
                // If customer, refresh their inbox
                if (appData.currentUser && appData.currentUser.role === 'customer') {
                    loadCustomerInbox();
                }
            });
            
            // New query button
            document.getElementById('new-query-btn').addEventListener('click', function() {
                // Only show form if user has permission
                if (appData.currentUser && appData.hasPermission('queries')) {
                    document.getElementById('query-form-container').style.display = 'block';
                    if (appData.currentUser.role === 'customer') {
                        document.getElementById('query-customer-name').value = appData.currentUser.name || '';
                        document.getElementById('query-customer-email').value = appData.currentUser.email || '';
                    }
                }
            });
            
            // New inbox query button
            document.getElementById('new-inbox-query-btn').addEventListener('click', function() {
                if (appData.currentUser && appData.currentUser.role === 'customer') {
                    document.getElementById('query-form-container').style.display = 'block';
                    document.getElementById('query-customer-name').value = appData.currentUser.name || '';
                    document.getElementById('query-customer-email').value = appData.currentUser.email || '';
                    showSection('queries');
                }
            });
            
            // Cancel query button
            document.getElementById('cancel-query-btn').addEventListener('click', function() {
                document.getElementById('query-form-container').style.display = 'none';
            });
            
            // Close query modal
            document.getElementById('close-query-modal').addEventListener('click', function() {
                document.getElementById('query-detail-modal').style.display = 'none';
            });
            
            // Send response button
            document.getElementById('send-response-btn').addEventListener('click', function() {
                const queryId = parseInt(document.getElementById('query-detail-modal').getAttribute('data-query-id'));
                const response = document.getElementById('query-response-text').value;
                
                if (!response) {
                    showAlert('Please enter a response', 'error');
                    return;
                }
                
                const updated = appData.updateQuery(queryId, { response: response });
                if (updated) {
                    showAlert('Response sent successfully!', 'success');
                    document.getElementById('query-detail-modal').style.display = 'none';
                    loadDashboardData();
                    
                    // If the query was from the current customer, refresh their inbox
                    const query = appData.queries.find(q => q.id === queryId);
                    if (appData.currentUser && appData.currentUser.email === query.email) {
                        loadCustomerInbox();
                    }
                }
            });
            document.getElementById('auto-response').addEventListener('change', function() {
    const enabled = this.value === 'enabled';
    appData.toggleAutoResponse(enabled);
    showAlert(`Auto-response has been ${enabled ? 'enabled' : 'disabled'}`, 'success');
    
    // Save to localStorage
    localStorage.setItem('autoResponseEnabled', enabled);
});
            
            // Mark complete button
            document.getElementById('mark-complete-btn').addEventListener('click', function() {
                const queryId = parseInt(document.getElementById('query-detail-modal').getAttribute('data-query-id'));
                
                const updated = appData.updateQuery(queryId, { status: 'Completed' });
                if (updated) {
                    showAlert('Query marked as complete!', 'success');
                    document.getElementById('query-detail-modal').style.display = 'none';
                    loadDashboardData();
                }
            });
            
            // Cancel response button
            document.getElementById('cancel-response-btn').addEventListener('click', function() {
                document.getElementById('query-detail-modal').style.display = 'none';
            });
            
            // Contact form submission
            document.getElementById('contact-form').addEventListener('submit', function(e) {
                e.preventDefault();
                const contactData = {
                    name: document.getElementById('contact-name').value,
                    email: document.getElementById('contact-email').value,
                    subject: document.getElementById('contact-subject').value,
                    message: document.getElementById('contact-message').value
                };
                
                // In a real app, this would send to a server
                showAlert('Thank you for your message! We will respond as soon as possible.', 'success');
                this.reset();
            });
            
            // Sale form submission
            document.getElementById('sale-form').addEventListener('submit', function(e) {
                e.preventDefault();
                const productId = parseInt(document.getElementById('sale-product').value);
                const product = appData.products.find(p => p.id === productId);
                
                if (!product) {
                    showAlert('Please select a valid product', 'error');
                    return;
                }
                
                const quantity = parseInt(document.getElementById('sale-quantity').value);
                
                if (quantity > product.quantity) {
                    showAlert(`Only ${product.quantity} items available in stock`, 'error');
                    return;
                }
                
                const sale = {
                    customer: document.getElementById('sale-customer').value,
                    productId: productId,
                    productName: product.name,
                    quantity: quantity,
                    price: parseFloat(document.getElementById('sale-price').value),
                    total: quantity * parseFloat(document.getElementById('sale-price').value)
                };
                
                const addedSale = appData.addSale(sale);
                if (addedSale.error) {
                    showAlert(addedSale.error, 'error');
                    return;
                }
                showAlert(`Sale recorded successfully! Total: M ${addedSale.total}`, 'success');
                this.reset();
                document.getElementById('sale-form-container').style.display = 'none';
                loadDashboardData();
            });
            
            // Add sale button
            document.getElementById('add-sale-btn').addEventListener('click', function() {
                // Only show form if user has permission
                if (appData.currentUser && appData.hasPermission('sales')) {
                    document.getElementById('sale-form-container').style.display = 'block';
                    
                    // Populate product dropdown
                    const productSelect = document.getElementById('sale-product');
                    productSelect.innerHTML = '<option value="">Select Product</option>';
                    
                    appData.products.forEach(product => {
                        if (product.quantity > 0) {
                            const option = document.createElement('option');
                            option.value = product.id;
                            option.textContent = `${product.name} (${product.quantity} available)`;
                            productSelect.appendChild(option);
                        }
                    });
                }
            });
            
            // Cancel sale button
            document.getElementById('cancel-sale-btn').addEventListener('click', function() {
                document.getElementById('sale-form-container').style.display = 'none';
            });
            
            // Add user button
            document.getElementById('add-user-btn').addEventListener('click', function() {
                // Only show form if user has permission
                if (appData.currentUser && ['admin', 'developer'].includes(appData.currentUser.role)) {
                    document.getElementById('user-form-container').style.display = 'block';
                    document.getElementById('user-form').removeAttribute('data-user-id');
                }
            });
            
            // User form submission
            document.getElementById('user-form').addEventListener('submit', function(e) {
                e.preventDefault();
                const userId = this.getAttribute('data-user-id');
                const userData = {
                    name: document.getElementById('user-name').value,
                    email: document.getElementById('user-email').value,
                    role: document.getElementById('user-role').value,
                    password: document.getElementById('user-password').value,
                    mfa: document.getElementById('user-mfa').checked
                };
                
                if (userId) {
                    // Update existing user
                    const updated = appData.updateUser(parseInt(userId), userData);
                    if (updated === true) {
                        showAlert(`User "${userData.name}" updated successfully!`, 'success');
                        this.reset();
                        this.removeAttribute('data-user-id');
                        document.getElementById('user-form-container').style.display = 'none';
                        loadDashboardData();
                    } else if (updated && updated.error) {
                        showAlert(updated.error, 'error');
                    }
                } else {
                    // Add new user
                    if (appData.users.some(u => u.email === userData.email)) {
                        showAlert('Email already exists', 'error');
                        return;
                    }
                    
                    const result = appData.addUser(userData);
                    if (result.error) {
                        showAlert(result.error, 'error');
                        return;
                    }
                    
                    showAlert(`User "${result.name}" added successfully!`, 'success');
                    this.reset();
                    document.getElementById('user-form-container').style.display = 'none';
                    loadDashboardData();
                }
            });
            
            // Cancel user button
            document.getElementById('cancel-user-btn').addEventListener('click', function() {
                document.getElementById('user-form').reset();
                document.getElementById('user-form').removeAttribute('data-user-id');
                document.getElementById('user-form-container').style.display = 'none';
            });
            
            // Settings form submission
            document.getElementById('settings-form').addEventListener('submit', function(e) {
                e.preventDefault();
                // In a real app, this would save settings to the server
                showAlert('Settings saved successfully!', 'success');
            });
            
            // Cancel settings button
            document.getElementById('cancel-settings-btn').addEventListener('click', function() {
                document.getElementById('settings-form').reset();
            });
            
            // Backup now button
            document.getElementById('backup-now-btn').addEventListener('click', function() {
                const success = appData.backupData();
                if (success) {
                    showAlert('Backup completed successfully!', 'success');
                } else {
                    showAlert('Backup failed', 'error');
                }
            });
            
            // System check button
            document.getElementById('system-check-btn').addEventListener('click', function() {
                // Simulate system check
                this.innerHTML = '<span class="spinner"></span> Running System Check...';
                setTimeout(() => {
                    this.textContent = 'Run System Check';
                    showAlert('System check completed. All systems operational.', 'success');
                }, 2000);
            });
            
            // Select all sales checkbox
            document.getElementById('select-all-sales').addEventListener('change', function() {
                const checkboxes = document.querySelectorAll('#sales-body input[type="checkbox"]');
                checkboxes.forEach(checkbox => {
                    checkbox.checked = this.checked;
                });
            });
            
            // Delete selected sales button
            document.getElementById('delete-selected-sales').addEventListener('click', function() {
                const selectedIds = [];
                document.querySelectorAll('#sales-body input[type="checkbox"]:checked').forEach(checkbox => {
                    selectedIds.push(parseInt(checkbox.value));
                });
                
                if (selectedIds.length === 0) {
                    showAlert('Please select at least one sale to delete', 'error');
                    return;
                }
                
                if (confirm(`Are you sure you want to delete ${selectedIds.length} selected sale(s)?`)) {
                    const deletedCount = appData.bulkDeleteSales(selectedIds);
                    if (deletedCount > 0) {
                        showAlert(`Successfully deleted ${deletedCount} sale(s)`, 'success');
                        loadDashboardData();
                        document.getElementById('select-all-sales').checked = false;
                    }
                }
            });
            
            // Export sales to CSV
            document.getElementById('export-sales').addEventListener('click', function() {
                const salesData = appData.sales.map(sale => ({
                    ID: sale.id,
                    Date: new Date(sale.date).toLocaleDateString(),
                    Customer: sale.customer,
                    Product: sale.productName,
                    Quantity: sale.quantity,
                    'Unit Price': sale.price,
                    Total: sale.total,
                    Status: sale.status,
                    'Sales Person': sale.salesPerson
                }));
                
                const csv = Papa.unparse(salesData);
                const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `iwb-sales-${new Date().toISOString().split('T')[0]}.csv`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                showAlert('Sales data exported to CSV', 'success');
            });
            
            // Export finance data
            document.getElementById('export-finance').addEventListener('click', function() {
                const financeData = appData.incomeStatements.map(statement => {
                    const grossProfit = statement.revenue - statement.costOfGoods;
                    const netProfit = grossProfit - statement.expenses;
                    return {
                        Month: statement.month,
                        Revenue: statement.revenue,
                        'Cost of Goods': statement.costOfGoods,
                        'Gross Profit': grossProfit,
                        Expenses: statement.expenses,
                        'Net Profit': netProfit
                    };
                });
                
                const csv = Papa.unparse(financeData);
                const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `iwb-finance-${new Date().toISOString().split('T')[0]}.csv`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                showAlert('Financial data exported to CSV', 'success');
            });
            
            // Print finance statement
            document.getElementById('print-finance').addEventListener('click', function() {
                showAlert('Printing is not supported in this demo', 'info');
            });
            
            // Export reports
            document.getElementById('export-reports').addEventListener('click', function() {
                showAlert('Reports exported successfully', 'success');
            });
            
            // Print reports
            document.getElementById('print-reports').addEventListener('click', function() {
                showAlert('Printing is not supported in this demo', 'info');
            });
            
            // Refresh sales data
            document.getElementById('refresh-sales').addEventListener('click', function() {
                loadDashboardData();
                showAlert('Sales data refreshed', 'success');
            });
            
            // Initialize charts
            initCharts();
        });
        
        function showSection(sectionId) {
            // Hide all sections
            document.querySelectorAll('.section').forEach(section => {
                section.classList.add('hidden');
            });
            
            // Show selected section
            document.getElementById(sectionId).classList.remove('hidden');
            
            // Check permissions and show/hide elements accordingly
            if (appData.currentUser) {
                // Hide query form container by default
                document.getElementById('query-form-container').style.display = 'none';
                
                // For queries section, show/hide new query button based on role
                if (sectionId === 'queries') {
                    document.getElementById('new-query-btn').style.display = 
                        appData.hasPermission('queries') ? 'block' : 'none';
                }
                
                // For inbox section, only show if customer
                if (sectionId === 'inbox' && appData.currentUser.role !== 'customer') {
                    showSection('home');
                    return;
                }
                
                // For investor section, only show if investor
                if (sectionId === 'investor' && appData.currentUser.role !== 'investor') {
                    showSection('home');
                    return;
                }
            }
            
            // Load data if needed
            if (sectionId === 'products') {
                loadProducts();
            } else if (sectionId === 'dashboard') {
                loadDashboardData();
            } else if (sectionId === 'queries') {
                loadQueries();
            } else if (sectionId === 'inbox') {
                loadCustomerInbox();
            } else if (sectionId === 'investor') {
                loadInvestorDashboard();
            }
        }
        
        function showTab(tabId) {
            // Hide all tab contents
            document.querySelectorAll('.dashboard').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Deactivate all tabs
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Activate selected tab
            document.querySelector(`.tab[data-tab="${tabId}"]`).classList.add('active');
            document.getElementById(`${tabId}-tab`).classList.add('active');
            
            // Load specific tab data if needed
            if (tabId === 'finance') {
                loadIncomeStatement();
            }
        }
        
        function updateNavigation() {
            if (!appData.currentUser) return;
            
            // Show/hide navigation items based on role
            document.getElementById('dashboard-nav-item').classList.toggle('hidden', 
                !['admin', 'sales', 'finance', 'developer', 'partner'].includes(appData.currentUser.role));
            
            document.getElementById('queries-nav-item').classList.toggle('hidden', 
                !['admin', 'sales'].includes(appData.currentUser.role));
            
            document.getElementById('inbox-nav-item').classList.toggle('hidden', 
                appData.currentUser.role !== 'customer');
            
            document.getElementById('investor-nav-item').classList.toggle('hidden', 
                appData.currentUser.role !== 'investor');
            
            // Update query badges
            appData.updateQueryBadges();
        }
        
        function loadProducts() {
            const productsContainer = document.getElementById('products-container');
            productsContainer.innerHTML = '';
            
            appData.products.forEach(product => {
                const productCard = document.createElement('div');
                productCard.className = 'product-card';
                productCard.innerHTML = `
                    <h3>${product.name}</h3>
                    <p>${product.description}</p>
                    <div class="price">M ${product.price}</div>
                    <p>${product.status}</p>
                    ${appData.currentUser && ['admin', 'sales'].includes(appData.currentUser.role) ? 
                        `<a href="#" class="btn" onclick="editProduct(${product.id})">Edit Product</a>` : 
                        `<a href="#" class="btn" onclick="showProductQuery(${product.id}, '${product.name}')">Inquire About This Product</a>`}
                `;
                productsContainer.appendChild(productCard);
            });
        }
        
        function loadDashboardData() {
            if (!appData.currentUser) return;
            
            // Check permissions for different tabs
            const isAdmin = appData.currentUser.role === 'admin';
            const isSales = ['admin', 'sales'].includes(appData.currentUser.role);
            const isFinance = ['admin', 'finance', 'partner'].includes(appData.currentUser.role);
            const isDeveloper = appData.currentUser.role === 'developer';
            
            // Show/hide access denied messages
            document.getElementById('finance-access-denied').classList.toggle('hidden', isFinance);
            document.getElementById('sales-access-denied').classList.toggle('hidden', isSales);
            document.getElementById('developer-access-denied').classList.toggle('hidden', isDeveloper);
            
            // Inventory data
            const inventoryBody = document.getElementById('inventory-body');
            inventoryBody.innerHTML = '';
            
            appData.products.forEach(product => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${product.id}</td>
                    <td>${product.name}</td>
                    <td>${product.category}</td>
                    <td>${product.quantity}</td>
                    <td>M ${product.price}</td>
                    <td><span class="status-badge ${product.status === 'Low Stock' ? 'status-pending' : 'status-completed'}">${product.status}</span></td>
                    <td class="action-btns">
                        ${isAdmin ? `
                            <button class="action-btn edit-btn" onclick="editProduct(${product.id})">Edit</button>
                            <button class="action-btn delete-btn" onclick="deleteProduct(${product.id})">Delete</button>
                        ` : ''}
                    </td>
                `;
                inventoryBody.appendChild(row);
            });
            
            // Update inventory stats
            document.getElementById('total-products').textContent = appData.products.length;
            document.getElementById('items-sold').textContent = appData.sales.reduce((sum, sale) => sum + sale.quantity, 0);
            document.getElementById('inventory-value').textContent = 'M ' + appData.products.reduce((sum, product) => sum + (product.price * product.quantity), 0);
            document.getElementById('low-stock-items').textContent = appData.products.filter(product => product.status === 'Low Stock').length;
            
            // Sales data
            const salesBody = document.getElementById('sales-body');
            salesBody.innerHTML = '';
            
            appData.sales.forEach(sale => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><input type="checkbox" value="${sale.id}"></td>
                    <td>${sale.id}</td>
                    <td>${new Date(sale.date).toLocaleDateString()}</td>
                    <td>${sale.customer}</td>
                    <td>${sale.productName}</td>
                    <td>${sale.quantity}</td>
                    <td>M ${sale.total}</td>
                    <td><span class="status-badge ${sale.status === 'Pending' ? 'status-pending' : 'status-completed'}">${sale.status}</span></td>
                    <td>${sale.salesPerson}</td>
                `;
                salesBody.appendChild(row);
            });
            
            // Update sales stats
            const monthlySales = appData.sales.reduce((sum, sale) => sum + sale.total, 0);
            document.getElementById('monthly-sales').textContent = 'M ' + monthlySales;
            document.getElementById('total-transactions').textContent = appData.sales.length;
            document.getElementById('avg-order-value').textContent = 'M ' + (appData.sales.length > 0 ? (monthlySales / appData.sales.length).toFixed(2) : 0);
            
            // Find top product
            if (appData.sales.length > 0) {
                const productSales = {};
                appData.sales.forEach(sale => {
                    if (!productSales[sale.productName]) {
                        productSales[sale.productName] = 0;
                    }
                    productSales[sale.productName] += sale.quantity;
                });
                
                let topProduct = '';
                let maxSales = 0;
                for (const [product, sales] of Object.entries(productSales)) {
                    if (sales > maxSales) {
                        maxSales = sales;
                        topProduct = product;
                    }
                }
                document.getElementById('top-product').textContent = topProduct;
            }
            
            // Load user management data
            const usersBody = document.getElementById('users-body');
            usersBody.innerHTML = '';
            
            appData.users.forEach(user => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${user.name}</td>
                    <td>${user.email}</td>
                    <td>${user.role}</td>
                    <td>${new Date(user.lastLogin).toLocaleString()}</td>
                    <td><span class="status-badge ${user.status === 'Active' ? 'status-active' : 'status-inactive'}">${user.status}</span></td>
                    <td class="action-btns">
                        ${(appData.currentUser.role === 'admin' || appData.currentUser.role === 'developer') ? `
                            <button class="action-btn edit-btn" onclick="editUser(${user.id})">Edit</button>
                            ${user.role !== 'admin' ? `<button class="action-btn delete-btn" onclick="deleteUser(${user.id})">Delete</button>` : ''}
                        ` : ''}
                    </td>
                `;
                usersBody.appendChild(row);
            });
            
            // Show/hide developer tools based on role
            document.getElementById('developer-tools').classList.toggle('hidden', 
                appData.currentUser.role !== 'developer');
            
            // Load queries if on queries page
            if (document.getElementById('queries').classList.contains('hidden') === false) {
                loadQueries();
            }
            // Hide settings tab from non-admin/developer roles
const settingsTab = document.querySelector('.tab[data-tab="settings"]');
if (settingsTab) {
    settingsTab.style.display = 
        ['admin', 'developer'].includes(appData.currentUser.role) ? 'block' : 'none';
}
        }
        
        function loadIncomeStatement() {
            const incomeStatementBody = document.getElementById('income-statement-body');
            incomeStatementBody.innerHTML = '';
            
            const expensesBody = document.getElementById('expenses-body');
            expensesBody.innerHTML = '';
            
            let totalRevenue = 0;
            let totalCost = 0;
            let totalExpenses = 0;
            let totalProfit = 0;
            
            // Expense categories breakdown
            const expenseCategories = {
                'Salaries': 0,
                'Utilities': 0,
                'Rent': 0,
                'Marketing': 0,
                'Other': 0
            };
            
            appData.incomeStatements.forEach(statement => {
                const grossProfit = statement.revenue - statement.costOfGoods;
                const netProfit = grossProfit - statement.expenses;
                
                totalRevenue += statement.revenue;
                totalCost += statement.costOfGoods;
                totalExpenses += statement.expenses;
                totalProfit += netProfit;
                
                // Distribute expenses to categories (simplified)
                expenseCategories['Salaries'] += statement.expenses * 0.5;
                expenseCategories['Utilities'] += statement.expenses * 0.2;
                expenseCategories['Rent'] += statement.expenses * 0.15;
                expenseCategories['Marketing'] += statement.expenses * 0.1;
                expenseCategories['Other'] += statement.expenses * 0.05;
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${statement.month}</td>
                    <td>M ${statement.revenue.toLocaleString()}</td>
                    <td>M ${statement.costOfGoods.toLocaleString()}</td>
                    <td>M ${grossProfit.toLocaleString()}</td>
                    <td>M ${statement.expenses.toLocaleString()}</td>
                    <td>M ${netProfit.toLocaleString()}</td>
                `;
                incomeStatementBody.appendChild(row);
            });
            
            // Update summary stats
            document.getElementById('total-revenue').textContent = 'M ' + totalRevenue.toLocaleString();
            document.getElementById('total-expenses').textContent = 'M ' + totalExpenses.toLocaleString();
            document.getElementById('net-profit').textContent = 'M ' + totalProfit.toLocaleString();
            document.getElementById('profit-margin').textContent = ((totalProfit / totalRevenue) * 100).toFixed(1) + '%';
            
            // Add expense breakdown
            for (const [category, amount] of Object.entries(expenseCategories)) {
                if (amount > 0) {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${category}</td>
                        <td>M ${amount.toLocaleString()}</td>
                        <td>${((amount / totalExpenses) * 100).toFixed(1)}%</td>
                    `;
                    expensesBody.appendChild(row);
                }
            }
        }
        function deleteQuery(queryId) {
    if (confirm('Are you sure you want to delete this query? This action cannot be undone.')) {
        const deleted = appData.deleteQuery(queryId);
        if (deleted === true) {
            showAlert('Query deleted successfully!', 'success');
            document.getElementById('query-detail-modal').style.display = 'none';
            loadQueries();
            
            // If the query was from the current customer, refresh their inbox
            const query = appData.queries.find(q => q.id === queryId);
            if (appData.currentUser && appData.currentUser.role === 'customer' && query) {
                loadCustomerInbox();
            }
        } else if (deleted && deleted.error) {
            showAlert(deleted.error, 'error');
        }
    }
}
        
        // Ensure query table truncates long messages appropriately
        function loadQueries() {
    if (!appData.currentUser) return;
    
    const queriesBody = document.getElementById('queries-body');
    queriesBody.innerHTML = '';
    
    appData.queries.forEach(query => {
        const row = document.createElement('tr');
        row.innerHTML = `
            <td>${query.id}</td>
            <td>${new Date(query.date).toLocaleDateString()}</td>
            <td>${query.customer}</td>
            <td>${query.email}</td>
            <td>${query.message.substring(0, 50)}${query.message.length > 50 ? '...' : ''}</td>
            <td><span class="status-badge ${query.status === 'Pending' ? 'status-pending' : 'status-completed'}">${query.status}</span></td>
            <td>${query.autoResponded ? 'Auto' : 'Manual'}</td>
            <td class="action-btns">
                ${['admin', 'sales'].includes(appData.currentUser.role) ? 
                    `<button class="action-btn view-btn" onclick="viewQuery(${query.id})">View</button>` : ''}
                ${['admin', 'developer'].includes(appData.currentUser.role) ? 
                    `<button class="action-btn delete-btn" onclick="deleteQuery(${query.id})">Delete</button>` : ''}
            </td>
        `;
        queriesBody.appendChild(row);
    });
    
    // Update queries stats
    document.getElementById('total-queries').textContent = appData.queries.length;
    document.getElementById('pending-queries').textContent = appData.queries.filter(q => q.status === 'Pending').length;
    document.getElementById('completed-queries').textContent = appData.queries.filter(q => q.status === 'Completed').length;
    document.getElementById('auto-queries').textContent = appData.queries.filter(q => q.autoResponded).length;
    
    // Update badges
    appData.updateQueryBadges();

    document.getElementById('query-search').addEventListener('input', function() {
    const searchTerm = this.value.toLowerCase();
    const filteredQueries = appData.queries.filter(q => 
        q.customer.toLowerCase().includes(searchTerm) ||
        q.email.toLowerCase().includes(searchTerm) ||
        q.message.toLowerCase().includes(searchTerm)
    );
    // Update table with filtered queries
    const queriesBody = document.getElementById('queries-body');
    queriesBody.innerHTML = '';
    filteredQueries.forEach(query => {
        const row = document.createElement('tr');
        const truncatedMessage = query.message.length > 50 
            ? query.message.substring(0, 50) + '...' 
            : query.message;
        row.innerHTML = `
            <td>${query.id}</td>
            <td>${new Date(query.date).toLocaleDateString()}</td>
            <td>${query.customer}</td>
            <td>${query.email}</td>
            <td>${truncatedMessage}</td>
            <td><span class="status-badge ${query.status === 'Pending' ? 'status-pending' : 'status-completed'}">${query.status}</span></td>
            <td>${query.autoResponded ? 'Auto' : 'Manual'}</td>
            <td class="action-btns">
                ${['admin', 'sales'].includes(appData.currentUser.role) ? 
                    `<button class="action-btn view-btn view-query-btn" onclick="viewQuery(${query.id})">View</button>` : ''}
            </td>
        `;
        queriesBody.appendChild(row);
    });
});
}
        
function loadCustomerInbox() {
    if (!appData.currentUser || appData.currentUser.role !== 'customer') return;
    
    const inboxContent = document.getElementById('inbox-content');
    inboxContent.innerHTML = '';
    
    const customerQueries = appData.getQueriesByEmail(appData.currentUser.email);
    
    if (customerQueries.length === 0) {
        inboxContent.innerHTML = '<p>You have no queries yet.</p>';
        return;
    }
    
    customerQueries.forEach(query => {
        const inboxItem = document.createElement('div');
        inboxItem.className = 'inbox-item';
        inboxItem.style.background = 'white';
        inboxItem.style.padding = '1.5rem';
        inboxItem.style.borderRadius = '8px';
        inboxItem.style.boxShadow = '0 3px 10px rgba(0,0,0,0.1)';
        inboxItem.style.marginBottom = '1.5rem';
        
        let responseHtml = '';
        if (query.response) {
            responseHtml = `
                <div style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid #eee;">
                    <h4 style="color: var(--primary-color); margin-bottom: 0.5rem;">Response</h4>
                    <p>${query.response}</p>
                    ${query.autoResponded ? 
                        '<p style="font-style: italic; color: #666;">Automatic response</p>' : 
                        '<p style="font-style: italic; color: #666;">From: Admin</p>'}
                </div>
            `;
        }
        
        inboxItem.innerHTML = `
            <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                <h3 style="color: var(--primary-color);">Query #${query.id}</h3>
                <span class="status-badge ${query.status === 'Pending' ? 'status-pending' : 'status-completed'}">${query.status}</span>
            </div>
            <p style="color: #666; margin-bottom: 0.5rem;">${new Date(query.date).toLocaleString()}</p>
            <div style="margin: 1rem 0;">
                ${query.message}
            </div>
            ${query.status === 'Completed' && query.response ? 
                '<p style="color: #2e7d32; font-weight: bold;">New Response Received!</p>' : ''}
            ${responseHtml}
        `;
        
        inboxContent.appendChild(inboxItem);
    });
    
    appData.updateQueryBadges();
}
        
        function loadInvestorDashboard() {
            if (!appData.currentUser || appData.currentUser.role !== 'investor') return;
            
            // Initialize investor chart
            const ctx = document.getElementById('investor-chart').getContext('2d');
            const investorChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Q1 2022', 'Q2 2022', 'Q3 2022', 'Q4 2022', 'Q1 2023', 'Q2 2023'],
                    datasets: [{
                        label: 'Revenue (M)',
                        data: [32000, 35000, 38000, 42000, 45000, 52000],
                        backgroundColor: 'rgba(123, 31, 162, 0.7)',
                        borderColor: 'rgba(123, 31, 162, 1)',
                        borderWidth: 1
                    }, {
                        label: 'Profit (M)',
                        data: [11000, 12000, 13000, 14500, 15500, 18000],
                        backgroundColor: 'rgba(255, 159, 64, 0.7)',
                        borderColor: 'rgba(255, 159, 64, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Quarterly Financial Performance'
                        },
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }
        
        function viewQuery(queryId) {
    const query = appData.queries.find(q => q.id === queryId);
    
    if (query) {
        // Prepare response source information
        let responseSource = '';
        if (query.response) {
            responseSource = query.autoResponded 
                ? '<p style="font-style: italic; color: #666;">Automatically responded by system</p>'
                : `<p style="font-style: italic; color: #666;">Responded by: ${appData.currentUser.name || 'Admin'}</p>`;
        }
        
        // Populate modal content with full query details
        document.getElementById('query-detail-content').innerHTML = `
            <p><strong>Query ID:</strong> ${query.id}</p>
            <p><strong>Date:</strong> ${new Date(query.date).toLocaleString()}</p>
            <p><strong>Customer:</strong> ${query.customer}</p>
            <p><strong>Email:</strong> ${query.email}</p>
            <p><strong>Message:</strong></p>
            <div style="background-color: #f5f5f5; padding: 1rem; border-radius: 5px; margin-bottom: 1rem;">
                ${query.message}
            </div>
            ${query.response ? `
            <p><strong>Response:</strong></p>
            <div style="background-color: #e8f5e9; padding: 1rem; border-radius: 5px; margin-bottom: 1rem;">
                ${query.response}
                ${responseSource}
            </div>
            ` : '<p><em>No response yet</em></p>'}
        `;
        
        // Set modal attributes and show it
        document.getElementById('query-detail-modal').setAttribute('data-query-id', query.id);
        document.getElementById('query-detail-modal').style.display = 'flex';
        
        // Set response textarea value
        document.getElementById('query-response-text').value = query.response || '';
        
        // Update button visibility based on query status
        if (query.status === 'Completed') {
            document.getElementById('send-response-btn').style.display = 'none';
            document.getElementById('mark-complete-btn').style.display = 'none';
        } else {
            document.getElementById('send-response-btn').style.display = 'inline-block';
            document.getElementById('mark-complete-btn').style.display = 'inline-block';
        }
    } else {
        showAlert('Query not found', 'error');
    }
}

// Enhance the send response button handler to ensure proper response saving
document.getElementById('send-response-btn').addEventListener('click', function() {
    const queryId = parseInt(document.getElementById('query-detail-modal').getAttribute('data-query-id'));
    const response = document.getElementById('query-response-text').value.trim();
    
    if (!response) {
        showAlert('Please enter a response', 'error');
        return;
    }
    
    const updated = appData.updateQuery(queryId, { 
        response: response,
        autoResponded: false // Ensure response is marked as manual
    });
    
    if (updated) {
        showAlert('Response sent successfully!', 'success');
        document.getElementById('query-detail-modal').style.display = 'none';
        loadQueries(); // Refresh queries table
        loadDashboardData(); // Update stats and badges
        
        // Refresh customer inbox if the query belongs to the current customer
        const query = appData.queries.find(q => q.id === queryId);
        if (appData.currentUser && appData.currentUser.email === query.email) {
            loadCustomerInbox();
        }
    } else {
        showAlert('Failed to send response', 'error');
    }
});
        
        function editProduct(productId) {
            const product = appData.products.find(p => p.id === productId);
            if (!product) return;
            
            document.getElementById('product-name').value = product.name;
            document.getElementById('product-category').value = product.category;
            document.getElementById('product-description').value = product.description;
            document.getElementById('product-quantity').value = product.quantity;
            document.getElementById('product-price').value = product.price;
            
            // Change form to update mode
            const form = document.getElementById('product-form');
            form.setAttribute('data-product-id', productId);
            form.querySelector('button[type="submit"]').textContent = 'Update Product';
            
            showTab('add');
        }
        
        function editUser(userId) {
            const user = appData.users.find(u => u.id === userId);
            if (!user) return;
            
            document.getElementById('user-name').value = user.name;
            document.getElementById('user-email').value = user.email;
            document.getElementById('user-role').value = user.role;
            document.getElementById('user-password').value = user.password;
            document.getElementById('user-mfa').checked = user.mfa;
            
            // Change form to update mode
            const form = document.getElementById('user-form');
            form.setAttribute('data-user-id', userId);
            document.getElementById('user-form-container').style.display = 'block';
        }
        
        function deleteProduct(productId) {
            if (confirm('Are you sure you want to delete this product?')) {
                const result = appData.deleteProduct(productId);
                if (result === true) {
                    showAlert('Product deleted successfully!', 'success');
                    loadDashboardData();
                } else if (result && result.error) {
                    showAlert(result.error, 'error');
                }
            }
        }
        
        function deleteUser(userId) {
            if (confirm('Are you sure you want to delete this user?')) {
                const result = appData.deleteUser(userId);
                if (result === true) {
                    showAlert('User deleted successfully!', 'success');
                    loadDashboardData();
                } else if (result && result.error) {
                    showAlert(result.error, 'error');
                }
            }
        }
        
        function showProductQuery(productId, productName) {
            document.getElementById('query-form-container').style.display = 'block';
            document.getElementById('query-message').value = `I'm interested in your ${productName} (ID: ${productId}). Please provide more information.`;
            
            if (appData.currentUser && appData.currentUser.role === 'customer') {
                document.getElementById('query-customer-name').value = appData.currentUser.name || '';
                document.getElementById('query-customer-email').value = appData.currentUser.email || '';
            }
            
            showSection('queries');
        }
        
        function showAlert(message, type, containerId = 'login-alert') {
            const alertDiv = document.getElementById(containerId);
            alertDiv.textContent = message;
            alertDiv.className = `alert alert-${type}`;
            alertDiv.classList.remove('hidden');
            
            setTimeout(() => {
                alertDiv.classList.add('hidden');
            }, 3000);
        }
        
        function initCharts() {
            // Sample sales chart
            const ctx = document.getElementById('sales-chart').getContext('2d');
            const salesChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul'],
                    datasets: [{
                        label: 'Revenue (M)',
                        data: [8500, 9200, 10100, 12450, 11800, 13200, 14500],
                        borderColor: '#2e7d32',
                        backgroundColor: 'rgba(46, 125, 50, 0.1)',
                        tension: 0.3,
                        fill: true
                    }, {
                        label: 'Expenses (M)',
                        data: [6200, 6800, 7200, 8230, 7900, 8500, 9100],
                        borderColor: '#d32f2f',
                        backgroundColor: 'rgba(211, 47, 47, 0.1)',
                        tension: 0.3,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Monthly Revenue vs Expenses'
                        },
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

       // Make functions available globally
window.editProduct = editProduct;
window.deleteProduct = deleteProduct;
window.editUser = editUser;
window.deleteUser = deleteUser;
window.showProductQuery = showProductQuery;
window.viewQuery = viewQuery;
window.deleteQuery = deleteQuery;
    </script>
</body>
<script src="enhancements.js"></script>
</html>